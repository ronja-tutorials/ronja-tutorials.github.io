<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Wobble Displacement</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="Summary So far we only used the vertex shader to move vertices from their object coordinates to their clip space coordinates (or to the world space c..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Wobble Displacement">
<meta itemprop="description" content="Summary So far we only used the vertex shader to move vertices from their object coordinates to their clip space coordinates (or to the world space c...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/015/Result.gif">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Wobble Displacement">
<meta name="twitter:description" content="Summary So far we only used the vertex shader to move vertices from their object coordinates to their clip space coordinates (or to the world space c...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/015/Result.gif">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/015/Result.gif">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/06/16/Wobble-Displacement.html">

<!-- Open Graph data -->
<meta property="og:title" content="Wobble Displacement" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/06/16/Wobble-Displacement.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/015/Result.gif" />

<meta property="og:description" content="Summary So far we only used the vertex shader to move vertices from their object coordinates to their clip space coordinates (or to the world space c..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-06-16T00:00:00+02:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/06/16/Wobble-Displacement.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">Wobble Displacement</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-06-16T00:00:00+02:00" itemprop="datePublished">
          
          Jun 16, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Wobble Displacement</h1>
    <p class="post-meta">
      <time datetime="2018-06-16T00:00:00+02:00" itemprop="datePublished">
        
        Jun 16, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#summary">Summary</a></li>
</ul>

  <div itemprop="articleBody">
    <h2 id="summary">Summary</h2>
<p>So far we only used the vertex shader to move vertices from their object coordinates to their clip space coordinates (or to the world space coordinates which we then used for other things). But there are more things we can do with vertex shaders. As a introduction I’m going to show you how to apply a simple sine wave to a model, making it wobble.</p>

<p>I will make the shader with a surface shader so you should know the basics of <a href="/2018/03/30/simple-surface.html">surface shaders</a>, but it works the same with any other type of shader.</p>

<p><img src="/assets/images/posts/015/Result.gif" alt="Result" /></p>

<p>When manipulating the positions of our surface, we use the vertex shader. So far we didn’t write a vertex shader in our surface shader, it was instead generated by unity in the background. To change that we add the declaration for it in our surface shader definition by adding the vertex:vertexShaderName part.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the shader is a surface shader, meaning that it will be extended by unity in the background </span>
    <span class="c1">//to have fancy lighting and other features</span>
    <span class="c1">//our surface shader function is called surf and we use our custom lighting model</span>
    <span class="c1">//fullforwardshadows makes sure unity adds the shadow passes the shader might need</span>
    <span class="c1">//vertex:vert makes the shader use vert as a vertex shader function</span>
    <span class="cp">#pragma surface surf Standard fullforwardshadows vertex:vert
</span></code></pre></div></div>

<p>Then we have to write the actual vertex function. Previously, in unlit shaders, we calculated the clip space position in there, but even when using vertex shaders, that part is generated for us in surface shaders. We manipulate the object space vertex positions and then let them be processed by unity.</p>

<p>Because the input struct has to have variables with specific names, it’s easiest to use a input struct unity provides for us here, it’s called appadata_full, but we could also use our own struct here if it uses the same terminology.</p>

<p>Just like the surface shader, the vertex shader in surface shaders (there should be better terminology for this) doesn’t return anything, instead it takes a parameter with the inout keyword we can manipulate.</p>

<p>Because surface shaders generate the conversion to clip space for us, a empty vertex function is all we need to make our shader work just like before.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>

<span class="p">}</span>
</code></pre></div></div>

<p>A simple thing we can do to our mesh is multiply all of our vertices by a value to make the model bigger. (a *= b is the same as a = a * b but a bit shorter)</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
    <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">xyz</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/015/ShadowRealm.png" alt="A bigger monkey head with the ghost of a small one inside" /></p>

<p>While the model is bigger we also see a weird artefact here. The shadow is still calculated based on the original, unmodified vertex positions. That’s because the surface shader doesn’t automatically generate a shadow pass (used for casting shadows) for our new vertex positions. To fix that we expand our surface definition with the hint addshadows and the artefects should be gone.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//addshadows tells the surface shader to generate a new shadow pass based on out vertex shader</span>
<span class="cp">#pragma surface surf Standard fullforwardshadows vertex:vert addshadow
</span></code></pre></div></div>
<p><img src="/assets/images/posts/015/FixedShadows.png" alt="A bigger monkey head with correct shadows" /></p>

<p>To make the shader more interresting we’ll change the vertex shader. Instead of making the model just bigger, we’ll offset the y position based on the sine of the x position, making it wavy.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
    <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/015/QueerMonkey.png" alt="A bigger monkey head with correct shadows" /></p>

<p>This results in big waves with a low frequency, so we’ll add two variables to change those properties.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//...</span>

<span class="n">_Amplitude</span> <span class="p">(</span><span class="s">"Wave Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span>
<span class="n">_Frequency</span> <span class="p">(</span><span class="s">"Wave Freqency"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">//...</span>

<span class="kt">float</span> <span class="n">_Amplitude</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">_Frequency</span><span class="p">;</span>

<span class="c1">//...</span>

<span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
<span class="n">float4</span> <span class="n">modifiedPos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">;</span>
<span class="n">modifiedPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>
<span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">modifiedPos</span><span class="p">;</span>

<span class="c1">//...</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/015/Sliders.png" alt="inspector where wave size is 0.23 and wave frequency is 5.14" /></p>

<p><img src="/assets/images/posts/015/WobblyMonkey.png" alt="inspector where wave size is 0.23 and wave frequency is 5.14" /></p>

<p>With this we have nice customizable waves on our model, but sadly the normals of our deformed models are wrong. We only moved the positions, not the normals.</p>

<p><img src="/assets/images/posts/015/WrongNormalsExplanation.png" alt="illustration in which direction the normals point/should point" /></p>

<p>The easiest and most flexible way to generate correct normals for custom geometry is to calculate the custom geometry for neighboring surface points and recalculate the normal from that.</p>

<p>To get neighboring surface points we can follow the tangent and bitangent of the surface. The normal, the tangent and the bitangent are all orthogonal to each other. The tangent and the bitangent both lie on the surface of the object.</p>

<p><img src="/assets/images/posts/015/ShowNormals.png" alt="illustration how normal, tangent and bitangent look like on a surface point" /></p>

<p>Normal in blue, tangent in red and bitangent in yellow.</p>

<p>Luckily the tangent are already saved in the model data, so we can just use them. The bitangent isn’t, but we can calculate it easily by taking the cross product of the normal and the tangent (taking the cross product of two vectors returns a vector that’s orthogonal to both).</p>

<p>After we obtain the bitangent we create two new points that are almost at the vertex position, but slightly changed, and give them the same treatment we gave the original position.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float3</span> <span class="n">posPlusTangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
<span class="n">posPlusTangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusTangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

<span class="n">float3</span> <span class="n">bitangent</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span><span class="p">);</span>
<span class="n">float3</span> <span class="n">posPlusBitangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">bitangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
<span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>
</code></pre></div></div>

<p>With those positions we can now calculate the new normal of the surface. For that we calculate a new tangent and bitangent from the positions by subtracting the modified base surface position from the modified surface positions where we added the tangent/bitangent previously. And after obtaining the new tangent and bitangent, we can take their cross product to get the new normal which we then use.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
    <span class="n">float4</span> <span class="n">modifiedPos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">;</span>
    <span class="n">modifiedPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>
    
    <span class="n">float3</span> <span class="n">posPlusTangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
    <span class="n">posPlusTangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusTangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">bitangent</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span><span class="p">);</span>
    <span class="n">float3</span> <span class="n">posPlusBitangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">bitangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
    <span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">modifiedTangent</span> <span class="o">=</span> <span class="n">posPlusTangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>
    <span class="n">float3</span> <span class="n">modifiedBitangent</span> <span class="o">=</span> <span class="n">posPlusBitangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">modifiedNormal</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">modifiedTangent</span><span class="p">,</span> <span class="n">modifiedBitangent</span><span class="p">);</span>
    <span class="n">data</span><span class="p">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">modifiedNormal</span><span class="p">);</span>
    <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">modifiedPos</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/015/CorrectNormals.png" alt="the wobbly monkey with correct normals" /></p>

<p>The last thing I’d like to add to this shader is movement over time. So far we only use the x position of the vertex as a changing parameter in our function which generates the new vertex positions, but adding the time to that is pretty easy.</p>

<p>Unity passes the time to all shaders automatically as a 4-dimentional vector, the first component of the vector is the time divided by 20, the second just the time in seconds, the third the time multiplied by 2 and the fourth contains the time multiplied by 3. Because we want to adjust the time via a external property we use the second component, with the time in seconds. We then add the time multiplied by the animation speed to the x position.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">_AnimationSpeed</span> <span class="p">(</span><span class="s">"Animation Speed"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">//...</span>

<span class="kt">float</span> <span class="n">_AnimationSpeed</span><span class="p">;</span>

<span class="c1">//...</span>

<span class="kt">void</span> <span class="nf">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
    <span class="n">float4</span> <span class="n">modifiedPos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">;</span>
    <span class="n">modifiedPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>
    
    <span class="n">float3</span> <span class="n">posPlusTangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
    <span class="n">posPlusTangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusTangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">bitangent</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span><span class="p">);</span>
    <span class="n">float3</span> <span class="n">posPlusBitangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">bitangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
    <span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">modifiedTangent</span> <span class="o">=</span> <span class="n">posPlusTangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>
    <span class="n">float3</span> <span class="n">modifiedBitangent</span> <span class="o">=</span> <span class="n">posPlusBitangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>

    <span class="n">float3</span> <span class="n">modifiedNormal</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">modifiedTangent</span><span class="p">,</span> <span class="n">modifiedBitangent</span><span class="p">);</span>
    <span class="n">data</span><span class="p">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">modifiedNormal</span><span class="p">);</span>
    <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">modifiedPos</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/015/Result.gif" alt="Result" /></p>

<p>I increased the offset of the sampled surface positions a bit (up to 0.01 units) to smooth over the artefacts better. A small distance can represent a more complex distortion better while bigger distances smoothes over some things.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/015_vertex_manipulation"</span> <span class="p">{</span>
    <span class="c1">//show values to edit in inspector</span>
    <span class="n">Properties</span> <span class="p">{</span>
        <span class="n">_Color</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
        <span class="n">_Smoothness</span> <span class="p">(</span><span class="s">"Smoothness"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">_Metallic</span> <span class="p">(</span><span class="s">"Metalness"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">[</span><span class="n">HDR</span><span class="p">]</span> <span class="n">_Emission</span> <span class="p">(</span><span class="s">"Emission"</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">_Amplitude</span> <span class="p">(</span><span class="s">"Wave Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span>
        <span class="n">_Frequency</span> <span class="p">(</span><span class="s">"Wave Freqency"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">_AnimationSpeed</span> <span class="p">(</span><span class="s">"Animation Speed"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="n">SubShader</span> <span class="p">{</span>
        <span class="c1">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry</span>
        <span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

        <span class="n">CGPROGRAM</span>

        <span class="c1">//the shader is a surface shader, meaning that it will be extended by unity in the background </span>
        <span class="c1">//to have fancy lighting and other features</span>
        <span class="c1">//our surface shader function is called surf and we use our custom lighting model</span>
        <span class="c1">//fullforwardshadows makes sure unity adds the shadow passes the shader might need</span>
        <span class="c1">//vertex:vert makes the shader use vert as a vertex shader function</span>
        <span class="c1">//addshadows tells the surface shader to generate a new shadow pass based on out vertex shader</span>
        <span class="cp">#pragma surface surf Standard fullforwardshadows vertex:vert addshadow
</span>        <span class="cp">#pragma target 3.0
</span>
        <span class="kt">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
        <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>

        <span class="kr">half</span> <span class="n">_Smoothness</span><span class="p">;</span>
        <span class="kr">half</span> <span class="n">_Metallic</span><span class="p">;</span>
        <span class="n">half3</span> <span class="n">_Emission</span><span class="p">;</span>

        <span class="kt">float</span> <span class="n">_Amplitude</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">_Frequency</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">_AnimationSpeed</span><span class="p">;</span>

        <span class="c1">//input struct which is automatically filled by unity</span>
        <span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
            <span class="n">float2</span> <span class="n">uv_MainTex</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="kt">void</span> <span class="n">vert</span><span class="p">(</span><span class="k">inout</span> <span class="n">appdata_full</span> <span class="n">data</span><span class="p">){</span>
            <span class="n">float4</span> <span class="n">modifiedPos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">;</span>
            <span class="n">modifiedPos</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">vertex</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>
            
            <span class="n">float3</span> <span class="n">posPlusTangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
            <span class="n">posPlusTangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusTangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

            <span class="n">float3</span> <span class="n">bitangent</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">normal</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">tangent</span><span class="p">);</span>
            <span class="n">float3</span> <span class="n">posPlusBitangent</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">+</span> <span class="n">bitangent</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
            <span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">posPlusBitangent</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">_Frequency</span> <span class="o">+</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_AnimationSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">_Amplitude</span><span class="p">;</span>

            <span class="n">float3</span> <span class="n">modifiedTangent</span> <span class="o">=</span> <span class="n">posPlusTangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>
            <span class="n">float3</span> <span class="n">modifiedBitangent</span> <span class="o">=</span> <span class="n">posPlusBitangent</span> <span class="o">-</span> <span class="n">modifiedPos</span><span class="p">;</span>

            <span class="n">float3</span> <span class="n">modifiedNormal</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">modifiedTangent</span><span class="p">,</span> <span class="n">modifiedBitangent</span><span class="p">);</span>
            <span class="n">data</span><span class="p">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">modifiedNormal</span><span class="p">);</span>
            <span class="n">data</span><span class="p">.</span><span class="n">vertex</span> <span class="o">=</span> <span class="n">modifiedPos</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//the surface shader function which sets parameters the lighting function then uses</span>
        <span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//sample and tint albedo texture</span>
            <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv_MainTex</span><span class="p">);</span>
            <span class="n">col</span> <span class="o">*=</span> <span class="n">_Color</span><span class="p">;</span>
            <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">col</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
            <span class="c1">//just apply the values for metalness, smoothness and emission</span>
            <span class="n">o</span><span class="p">.</span><span class="n">Metallic</span> <span class="o">=</span> <span class="n">_Metallic</span><span class="p">;</span>
            <span class="n">o</span><span class="p">.</span><span class="n">Smoothness</span> <span class="o">=</span> <span class="n">_Smoothness</span><span class="p">;</span>
            <span class="n">o</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="n">_Emission</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">ENDCG</span>
    <span class="p">}</span>
    <span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can also find the source code for this tutorial here:
<a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/015_VertexManipulation/vertexmanipulation.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/015_VertexManipulation/vertexmanipulation.shader</a></p>

<p>I hope I was able to explain how to start manipulating vertices and you find your own ways of making nice looking shaders with this technique.</p>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
