<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>2D SDF Combination</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="In the last tutorial we learned how to create and move simple shapes with signed distance functions. In this one we will learn how to combine several..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="2D SDF Combination">
<meta itemprop="description" content="In the last tutorial we learned how to create and move simple shapes with signed distance functions. In this one we will learn how to combine several...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/035/Result.gif">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="2D SDF Combination">
<meta name="twitter:description" content="In the last tutorial we learned how to create and move simple shapes with signed distance functions. In this one we will learn how to combine several...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/035/Result.gif">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/035/Result.gif">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/11/17/2d-sdf-combination.html">

<!-- Open Graph data -->
<meta property="og:title" content="2D SDF Combination" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/11/17/2d-sdf-combination.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/035/Result.gif" />

<meta property="og:description" content="In the last tutorial we learned how to create and move simple shapes with signed distance functions. In this one we will learn how to combine several..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-11-17T00:00:00+01:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/11/17/2d-sdf-combination.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">2D SDF Combination</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-11-17T00:00:00+01:00" itemprop="datePublished">
          
          Nov 17, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">2D SDF Combination</h1>
    <p class="post-meta">
      <time datetime="2018-11-17T00:00:00+01:00" itemprop="datePublished">
        
        Nov 17, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#setup">Setup</a></li>
  <li><a href="#simple-combinations">Simple Combinations</a>
    <ul>
      <li><a href="#union">Union</a></li>
      <li><a href="#intersection">Intersection</a></li>
      <li><a href="#subtraction">Subtraction</a></li>
      <li><a href="#interpolation">Interpolation</a></li>
    </ul>
  </li>
  <li><a href="#other-combinations">Other Combinations</a>
    <ul>
      <li><a href="#round">Round</a></li>
      <li><a href="#champfer">Champfer</a></li>
      <li><a href="#round-intersection">Round Intersection</a></li>
      <li><a href="#border-groove">Border Groove</a></li>
    </ul>
  </li>
  <li><a href="#source">Source</a>
    <ul>
      <li><a href="#library">Library</a></li>
      <li><a href="#shader-base">Shader base</a></li>
    </ul>
  </li>
</ul>

  <div itemprop="articleBody">
    <p>In the <a href="/2018/11/10/2d-sdf-basics.html">last tutorial</a> we learned how to create and move simple shapes with signed distance functions. In this one we will learn how to combine several shapes to make more complex distance fields. I learned most of the techniques described here from a glsl signed distance function library you can find <a href="http://mercury.sexy/hg_sdf">here (http://mercury.sexy/hg_sdf)</a> and there are a few ways of combining shapes I don’t go into here.</p>

<p><img src="/assets/images/posts/035/Result.gif" alt="" /></p>

<h2 id="setup">Setup</h2>

<p>To visualise the signed distance fields, we’re going to make one basic setup and then use the operators with it. It will use the distance lines visualisation we made in the first tutorial for showing the distance fields. We will set all parameters except for the visualisation parameters in code for simplicity, but you can replace any value you see with a property to make it adjustable.</p>

<p>The main shader we start with looks like this:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/035_2D_SDF_Combinations/Champfer Union"</span><span class="p">{</span>
    <span class="n">Properties</span><span class="p">{</span>
        <span class="n">_InsideColor</span><span class="p">(</span><span class="s">"Inside Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_OutsideColor</span><span class="p">(</span><span class="s">"Outside Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">_LineDistance</span><span class="p">(</span><span class="s">"Mayor Line Distance"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_LineThickness</span><span class="p">(</span><span class="s">"Mayor Line Thickness"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">05</span>

        <span class="p">[</span><span class="n">IntRange</span><span class="p">]</span><span class="n">_SubLines</span><span class="p">(</span><span class="s">"Lines between major lines"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">_SubLineThickness</span><span class="p">(</span><span class="s">"Thickness of inbetween lines"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">05</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span>
    <span class="p">}</span>

    <span class="n">SubShader</span><span class="p">{</span>
        <span class="c1">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry</span>
        <span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

        <span class="n">Pass</span><span class="p">{</span>
            <span class="n">CGPROGRAM</span>

            <span class="cp">#include "UnityCG.cginc"
</span>            <span class="cp">#include "2D_SDF.cginc"
</span>
            <span class="cp">#pragma vertex vert
</span>            <span class="cp">#pragma fragment frag
</span>
            <span class="k">struct</span> <span class="n">appdata</span><span class="p">{</span>
                <span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="k">struct</span> <span class="n">v2f</span><span class="p">{</span>
                <span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">worldPos</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">){</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="c1">//calculate the position in clip space to render the object</span>
                <span class="n">o</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//calculate world position of vertex</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">float</span> <span class="n">scene</span><span class="p">(</span><span class="n">float2</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14159</span><span class="p">;</span>

                <span class="n">float2</span> <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
                <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
                <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="p">.</span><span class="mi">125</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">squareShape</span> <span class="o">=</span> <span class="n">rectangle</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

                <span class="n">float2</span> <span class="n">circlePosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
                <span class="n">circlePosition</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">circlePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
                <span class="kt">float</span> <span class="n">circleShape</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="n">circlePosition</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">combination_function</span><span class="p">(</span><span class="n">circleShape</span><span class="p">,</span> <span class="n">squareShape</span><span class="p">);</span>

                <span class="k">return</span> <span class="n">combination</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">float4</span> <span class="n">_InsideColor</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">_OutsideColor</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">_LineDistance</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">_LineThickness</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">_SubLines</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">_SubLineThickness</span><span class="p">;</span>

            <span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
                <span class="kt">float</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">xz</span><span class="p">);</span>
                <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">_InsideColor</span><span class="p">,</span> <span class="n">_OutsideColor</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">));</span>

                <span class="kt">float</span> <span class="n">distanceChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">majorLineDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">frac</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="n">_LineDistance</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_LineDistance</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">majorLines</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">_LineThickness</span> <span class="o">-</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">_LineThickness</span> <span class="o">+</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">majorLineDistance</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">distanceBetweenSubLines</span> <span class="o">=</span> <span class="n">_LineDistance</span> <span class="o">/</span> <span class="n">_SubLines</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">subLineDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">frac</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="n">distanceBetweenSubLines</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">distanceBetweenSubLines</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">subLines</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">_SubLineThickness</span> <span class="o">-</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">_SubLineThickness</span> <span class="o">+</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">subLineDistance</span><span class="p">);</span>

                <span class="k">return</span> <span class="n">col</span> <span class="o">*</span> <span class="n">majorLines</span> <span class="o">*</span> <span class="n">subLines</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">FallBack</span> <span class="s">"Standard"</span> <span class="c1">//fallback adds a shadow pass so we get shadows on other objects</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And the 2D_SDF.cginc function in the same folder as the shader we will expand looks like this at the start:</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef SDF_2D
#define SDF_2D
</span>
<span class="c1">//transforms</span>

<span class="n">float2</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">rotation</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14159</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">*</span> <span class="n">PI</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">sine</span><span class="p">,</span> <span class="n">cosine</span><span class="p">;</span>
    <span class="n">sincos</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">sine</span><span class="p">,</span> <span class="n">cosine</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">float2</span><span class="p">(</span><span class="n">cosine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cosine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">sine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">float2</span> <span class="nf">translate</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="n">float2</span> <span class="n">offset</span><span class="p">){</span>
    <span class="c1">//move samplepoint in the opposite direction that we want to move shapes in</span>
    <span class="k">return</span> <span class="n">samplePosition</span> <span class="o">-</span> <span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">float2</span> <span class="nf">scale</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">samplePosition</span> <span class="o">/</span> <span class="n">scale</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//shapes</span>

<span class="kt">float</span> <span class="nf">circle</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="c1">//get distance from center and grow it according to radius</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">samplePosition</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">rectangle</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="n">float2</span> <span class="n">halfSize</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">componentWiseEdgeDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">samplePosition</span><span class="p">)</span> <span class="o">-</span> <span class="n">halfSize</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">componentWiseEdgeDistance</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">componentWiseEdgeDistance</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">componentWiseEdgeDistance</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">outsideDistance</span> <span class="o">+</span> <span class="n">insideDistance</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif
</span></code></pre></div></div>

<h2 id="simple-combinations">Simple Combinations</h2>

<p>We’ll start with a few simple ways of combining two shapes to make one bigger shape, unions, intersections and subtractions. And a way to make one shape morph into another.</p>

<h3 id="union">Union</h3>

<p>The most basic operator is a union. With it we can add two shapes together and get the signed distance of the combined shape. When we have the signed distance of two shapes we can combine them by taking the smaller value of the two with the <code class="language-plaintext highlighter-rouge">min</code> function.</p>

<p>By using the minimum of the two values the end shape will be below 0 (visible) where one of the two input shapes has a distance to the edge which is below 0, the same works for all other distance values, showing the combination of both shapes.</p>

<p>I call the function to create a union “merge” here, partly because it’s the act of merging them, partly because the union keyword is reserverd in hlsl so we can’t use it as a function name.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in 2D_SDF.cginc include file</span>

<span class="kt">float</span> <span class="nf">merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in scene function in shader</span>

<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">circleShape</span><span class="p">,</span> <span class="n">squareShape</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/Union.png" alt="" /></p>

<h3 id="intersection">Intersection</h3>

<p>Another common way of combining shapes is to use the areas where two shapes overlap. For this we take the maximum value of the two shape distances we want to combine. When using the bigger value of the two, we get a value above 0 (outside the shape) whenever any of the distances to the two shapes is outside the shape and the other distances line up similarly again.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in 2D_SDF.cginc include file</span>

<span class="kt">float</span> <span class="nf">intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in scene function in shader</span>

<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">circleShape</span><span class="p">,</span> <span class="n">squareShape</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/Intersection.png" alt="" /></p>

<h3 id="subtraction">Subtraction</h3>

<p>Often we don’t want to treat both shapes the same though, instead we want to subtract one shape from the other. This is pretty easy to do by doing a intersection between the shape we want to modify and everything but the shape we want to subtract. The way we get invert the inside and outside of a shape is by negating the signed distance. What was 1 unit outside the shape is 1 unit inside it now.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in 2D_SDF.cginc include file</span>

<span class="kt">float</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in scene function in shader</span>

<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">squareShape</span><span class="p">,</span> <span class="n">circleShape</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/Subtraction.png" alt="" /></p>

<h3 id="interpolation">Interpolation</h3>

<p>A non-obvious way of combining two shapes is to interpolate beteen them. This is also possible to some extent with polygon meshes with blendshapes, but is way more limited that what we can do with signed distance fields. By simply interpolating between the distances of two shapes they smoothly morph into each other. For the interpolation we can simply use the <code class="language-plaintext highlighter-rouge">lerp</code> method.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in 2D_SDF.cginc include file</span>

<span class="kt">float</span> <span class="nf">interpolate</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">amount</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in scene function in shader</span>

<span class="kt">float</span> <span class="n">pulse</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">_Time</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="n">circleShape</span><span class="p">,</span> <span class="n">pulse</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/Interpolation.gif" alt="" /></p>

<h2 id="other-combinations">Other Combinations</h2>

<p>With the simply combinations we already have everything we need to just combine shapes, but the wonderful thing about signed distance fields is that we aren’t limited to this, there are many other ways we can combine shapes and do interresting stuff where they connect. Again, I’ll only explain a few of the techniques, but you can see more of them at <a href="http://mercury.sexy/hg_sdf">http://mercury.sexy/hg_sdf</a>(write me if you know more useful SDF libraries).</p>

<h3 id="round">Round</h3>

<p>We can interpret the surface of the two shapes we’re combining as the x and y axis of position in a coordinate system and then calculate the distance to the origin of that position. If we do that it’ll give us a really weird shape, but if we limit the axis to values below 0 we get something that looks like a smooth union of the inside distances of the two shapes.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundInsideUnion.png" alt="" /></p>

<p>That’s nice, but we can’t change the line where the distance is 0 is with this, so it’s not more valuable that a regular union so far. But what we can do is to grow the two shapes bigger before combining them. Similarly to when we created the circle, to grow a shape we subtract from it’s distance to push the line where the signed distance is 0 further outside.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">round_intersect</span><span class="p">(</span><span class="n">squareShape</span><span class="p">,</span> <span class="n">circleShape</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundInsideExpandedUnion.gif" alt="" /></p>

<p>This just grows our shape and makes sure the transition inside is smooth, but we don’t want to grow the shapes, we just want a smooth transition. The solution for this is to subtract the radius again after we calculated the length, most parts will look just like before, except the transition between the shapes which is smoothed nicely based on the radius. Just ignore the outside of the shape for now.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundInsideSmoothedUnion.gif" alt="" /></p>

<p>The last step is to fix the outside of the shape. Also right now the inside of the shape is green which is the color we use for the outside. The first step is to flip inside and outside by simply inverting the signed distance. Then we replace the part where we subtract the radius. First we change it from a subtraction to a addition. That’s because we invert the distance of the vector before combining it with the radius, so to keep in line with the inversion we also invert the math operation we use. Then we replace the radius with a regular union, this gives us correct values outside of the shape, but not close to the edge or inside it, to avoid that we take the maximum between it and the radius, this way we get the positive of correct values outside of the shape as well as the addition of the radius inside it we need.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="o">-</span><span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">simpleUnion</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">simpleUnion</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>
    <span class="k">return</span>  <span class="n">insideDistance</span> <span class="o">+</span> <span class="n">outsideDistance</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundUnion.gif" alt="" /></p>

<p>For the Intersection we have to do the opposite, we shrink the shapes by the radius, make sure the components of the vector are above 0 and take the length and don’t invert it. This builds the outside of the shape. Then to create the inside we take a regular intersection and make sure it doesn’t get lower than minus the radius. Then we add the inside and outside values just like before.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">+</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">simpleIntersection</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">simpleIntersection</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">outsideDistance</span> <span class="o">+</span> <span class="n">insideDistance</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundIntersection.gif" alt="" /></p>

<p>And as a last point the subtraction can again be descibed as a intersection between the base shape and everything except the shape we’re subtracting.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">round_intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/RoundSubtraction.gif" alt="" /></p>

<p>Especially in the subtraction you can see the artefacts that come from assuming that we can use the two shapes as coordinates, but the distance field is still good enough to use it for most purposes.</p>

<h3 id="champfer">Champfer</h3>

<p>Another thing we can do is to to champfer the transition to give it a bevel like corner. To get that effect we first create a new shape by adding the existing two. If we again assume the point where the two shapes meet is orthogonal this operation would give us a diagonal line which goes though the point where the two surfaces meet.</p>

<p><img src="/assets/images/posts/035/ChampferLine.png" alt="" /></p>

<p>because we simply added the two components, the signed distance of this new line has the wrong scaling, but we can fix it by dividing it by the diagonal of a unit square, 
the square root of 2. Dividing by the square root of 2 is the same as multiplying it with the square root of 0.5 and we can simply write that value into our code to not make it calculate the same root every time.</p>

<p>Now that we have a shape that has the shape of our champfer, we can expand it to make the chamfer be outside the shape. Just like previously, we subtract the amount we want to make the shape expand. Then we merge the champfer shape with the output of a regular merge and we have a champfered transition.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">champferSize</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">champfer_merge</span><span class="p">(</span><span class="n">circleShape</span><span class="p">,</span> <span class="n">squareShape</span><span class="p">,</span> <span class="n">champferSize</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">champfer_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">SQRT_05</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">70710678118</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">simpleMerge</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">champfer</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">shape2</span><span class="p">)</span> <span class="o">*</span> <span class="n">SQRT_05</span><span class="p">;</span>
    <span class="n">champfer</span> <span class="o">=</span> <span class="n">champfer</span> <span class="o">-</span> <span class="n">champferSize</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">merge</span><span class="p">(</span><span class="n">simpleMerge</span><span class="p">,</span> <span class="n">champfer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/ChampferUnion.gif" alt="" /></p>

<p>For the intersected champfer we add the two shapes like previously, but then we shrink the shape by adding the champfer amount and then doing a intersection with the regular intersected shape.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">champfer_intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">SQRT_05</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">70710678118</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">simpleIntersect</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">champfer</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">shape2</span><span class="p">)</span> <span class="o">*</span> <span class="n">SQRT_05</span><span class="p">;</span>
    <span class="n">champfer</span> <span class="o">=</span> <span class="n">champfer</span> <span class="o">+</span> <span class="n">champferSize</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">intersect</span><span class="p">(</span><span class="n">simpleIntersect</span><span class="p">,</span> <span class="n">champfer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/ChampferIntersect.gif" alt="" /></p>

<p>And similarly to the previous subtractions we can also do a intersection with a inverted second shape here.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">champfer_subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">champfer_intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">,</span> <span class="n">champferSize</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/ChampferSubtract.gif" alt="" /></p>

<h3 id="round-intersection">Round Intersection</h3>

<p>So far we only used boolean operators (apart from interpolating). But we can also combine the shapes in other ways, for example we can create new round shapes where the borders of two shapes overlap.</p>

<p>To do this we again interpret the two shapes as the x and y axis of a point. Then we simply calculate that points distance from the origin. Where the shapes borders overlap, the distance of both shapes will be 0, giving us a distance of 0 from the origin in our made-up coordinate system. Then that we have the distance from the origin we can give it the same treatment as we did for circles and subtract the radius.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">round_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">position</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">distanceFromBorderIntersection</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">distanceFromBorderIntersection</span> <span class="o">-</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/BorderIntersection.png" alt="" /></p>

<h3 id="border-groove">Border Groove</h3>

<p>The last technique I’ll explain is a way to make a groove in one shape at the position of the border of another shape.</p>

<p>We start by calculating the shape of the border of the circle. We do this by getting the absolute value of the distance of the first shape, this way inside as well as outside counts as inside the shape, but the border still has the value of 0. If we grow this shape by subtracting the width of the groove we get a shape around the border of the previous shape.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="n">groove_border</span><span class="p">(</span><span class="n">squareShape</span><span class="p">,</span> <span class="n">circleShape</span><span class="p">,</span> <span class="p">.</span><span class="mi">3</span><span class="p">,</span> <span class="n">depth</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">groove_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">groove</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">depth</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">circleBorder</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">groove</span><span class="p">)</span> <span class="o">-</span> <span class="n">width</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">circleBorder</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/CircleBorder.png" alt="" /></p>

<p>Then we want the circle border to only go as deep as we specify. To do this we subtract a shrunk version of the base shape from it. The amount we shrink the base is the depth of the groove.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">groove_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">groove</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">depth</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">circleBorder</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">groove</span><span class="p">)</span> <span class="o">-</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">grooveShape</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">circleBorder</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="n">depth</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">grooveShape</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/GrooveShape.gif" alt="" /></p>

<p>Then as a last step we subtract the groove from the base shape and return the result.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">groove_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">groove</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">depth</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">circleBorder</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">groove</span><span class="p">)</span> <span class="o">-</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">grooveShape</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">circleBorder</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="n">depth</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grooveShape</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/035/Groove.gif" alt="" /></p>

<h2 id="source">Source</h2>

<h3 id="library">Library</h3>

<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/2D_SDF.cginc">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/2D_SDF.cginc</a></li>
</ul>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef SDF_2D
#define SDF_2D
</span>
<span class="c1">//transforms</span>

<span class="n">float2</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">rotation</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14159</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">rotation</span> <span class="o">*</span> <span class="n">PI</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">sine</span><span class="p">,</span> <span class="n">cosine</span><span class="p">;</span>
    <span class="n">sincos</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">sine</span><span class="p">,</span> <span class="n">cosine</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">float2</span><span class="p">(</span><span class="n">cosine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">sine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cosine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">sine</span> <span class="o">*</span> <span class="n">samplePosition</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">float2</span> <span class="nf">translate</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="n">float2</span> <span class="n">offset</span><span class="p">){</span>
    <span class="c1">//move samplepoint in the opposite direction that we want to move shapes in</span>
    <span class="k">return</span> <span class="n">samplePosition</span> <span class="o">-</span> <span class="n">offset</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">float2</span> <span class="nf">scale</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">scale</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">samplePosition</span> <span class="o">/</span> <span class="n">scale</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//combinations</span>

<span class="c1">///basic</span>
<span class="kt">float</span> <span class="nf">merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">min</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">max</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">interpolate</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">amount</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// round</span>
<span class="kt">float</span> <span class="nf">round_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">-</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="o">-</span><span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">simpleUnion</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">simpleUnion</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>
    <span class="k">return</span>  <span class="n">insideDistance</span> <span class="o">+</span> <span class="n">outsideDistance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">round_intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">shape2</span> <span class="o">+</span> <span class="n">radius</span><span class="p">);</span>
    <span class="n">intersectionSpace</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">intersectionSpace</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">simpleIntersection</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">simpleIntersection</span><span class="p">,</span> <span class="o">-</span><span class="n">radius</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">outsideDistance</span> <span class="o">+</span> <span class="n">insideDistance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">round_subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">round_intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">,</span> <span class="n">radius</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">///champfer</span>
<span class="kt">float</span> <span class="nf">champfer_merge</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">SQRT_05</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">70710678118</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">simpleMerge</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">champfer</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">shape2</span><span class="p">)</span> <span class="o">*</span> <span class="n">SQRT_05</span><span class="p">;</span>
    <span class="n">champfer</span> <span class="o">=</span> <span class="n">champfer</span> <span class="o">-</span> <span class="n">champferSize</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">merge</span><span class="p">(</span><span class="n">simpleMerge</span><span class="p">,</span> <span class="n">champfer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">champfer_intersect</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">const</span> <span class="kt">float</span> <span class="n">SQRT_05</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">70710678118</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">simpleIntersect</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">champfer</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape1</span> <span class="o">+</span> <span class="n">shape2</span><span class="p">)</span> <span class="o">*</span> <span class="n">SQRT_05</span><span class="p">;</span>
    <span class="n">champfer</span> <span class="o">=</span> <span class="n">champfer</span> <span class="o">+</span> <span class="n">champferSize</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">intersect</span><span class="p">(</span><span class="n">simpleIntersect</span><span class="p">,</span> <span class="n">champfer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">champfer_subtract</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">subtraction</span><span class="p">,</span> <span class="kt">float</span> <span class="n">champferSize</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">champfer_intersect</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="o">-</span><span class="n">subtraction</span><span class="p">,</span> <span class="n">champferSize</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// round border intersection</span>
<span class="kt">float</span> <span class="nf">round_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">shape1</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shape2</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">position</span> <span class="o">=</span> <span class="n">float2</span><span class="p">(</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">distanceFromBorderIntersection</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">distanceFromBorderIntersection</span> <span class="o">-</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">groove_border</span><span class="p">(</span><span class="kt">float</span> <span class="n">base</span><span class="p">,</span> <span class="kt">float</span> <span class="n">groove</span><span class="p">,</span> <span class="kt">float</span> <span class="n">width</span><span class="p">,</span> <span class="kt">float</span> <span class="n">depth</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">circleBorder</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">groove</span><span class="p">)</span> <span class="o">-</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">grooveShape</span> <span class="o">=</span> <span class="n">subtract</span><span class="p">(</span><span class="n">circleBorder</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="n">depth</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">subtract</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grooveShape</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//shapes</span>

<span class="kt">float</span> <span class="nf">circle</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">){</span>
    <span class="c1">//get distance from center and grow it according to radius</span>
    <span class="k">return</span> <span class="n">length</span><span class="p">(</span><span class="n">samplePosition</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">rectangle</span><span class="p">(</span><span class="n">float2</span> <span class="n">samplePosition</span><span class="p">,</span> <span class="n">float2</span> <span class="n">halfSize</span><span class="p">){</span>
    <span class="n">float2</span> <span class="n">componentWiseEdgeDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">samplePosition</span><span class="p">)</span> <span class="o">-</span> <span class="n">halfSize</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">outsideDistance</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">componentWiseEdgeDistance</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">insideDistance</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">componentWiseEdgeDistance</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">componentWiseEdgeDistance</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">outsideDistance</span> <span class="o">+</span> <span class="n">insideDistance</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif
</span></code></pre></div></div>

<h3 id="shader-base">Shader base</h3>

<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_union.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_union.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_intersect.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_intersect.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_subtract.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_subtract.shader</a></li>
  <li>
    <p><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_interpolate.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Simple/sdf_interpolate.shader</a></p>
  </li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_round.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_round.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_champfer.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_champfer.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_border_intersection.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_border_intersection.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_groove.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/035_SDF_combining_repeating/Fancy/sdf_groove.shader</a></li>
</ul>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/035_2D_SDF_Combinations/Round"</span><span class="p">{</span>
    <span class="n">Properties</span><span class="p">{</span>
        <span class="n">_InsideColor</span><span class="p">(</span><span class="s">"Inside Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_OutsideColor</span><span class="p">(</span><span class="s">"Outside Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">_LineDistance</span><span class="p">(</span><span class="s">"Mayor Line Distance"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">_LineThickness</span><span class="p">(</span><span class="s">"Mayor Line Thickness"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">05</span>

        <span class="p">[</span><span class="n">IntRange</span><span class="p">]</span><span class="n">_SubLines</span><span class="p">(</span><span class="s">"Lines between major lines"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">_SubLineThickness</span><span class="p">(</span><span class="s">"Thickness of inbetween lines"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">05</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span>
    <span class="p">}</span>

    <span class="n">SubShader</span><span class="p">{</span>
        <span class="c1">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry</span>
        <span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

        <span class="n">Pass</span><span class="p">{</span>
            <span class="n">CGPROGRAM</span>

            <span class="cp">#include "UnityCG.cginc"
</span>            <span class="cp">#include "2D_SDF.cginc"
</span>
            <span class="cp">#pragma vertex vert
</span>            <span class="cp">#pragma fragment frag
</span>
            <span class="k">struct</span> <span class="n">appdata</span><span class="p">{</span>
                <span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="k">struct</span> <span class="n">v2f</span><span class="p">{</span>
                <span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
                <span class="n">float4</span> <span class="n">worldPos</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
            <span class="p">};</span>

            <span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">){</span>
                <span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
                <span class="c1">//calculate the position in clip space to render the object</span>
                <span class="n">o</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="c1">//calculate world position of vertex</span>
                <span class="n">o</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">unity_ObjectToWorld</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kt">float</span> <span class="n">scene</span><span class="p">(</span><span class="n">float2</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14159</span><span class="p">;</span>

                <span class="n">float2</span> <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
                <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
                <span class="n">squarePosition</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="p">.</span><span class="mi">125</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">squareShape</span> <span class="o">=</span> <span class="n">rectangle</span><span class="p">(</span><span class="n">squarePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

                <span class="n">float2</span> <span class="n">circlePosition</span> <span class="o">=</span> <span class="n">position</span><span class="p">;</span>
                <span class="n">circlePosition</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">circlePosition</span><span class="p">,</span> <span class="n">float2</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
                <span class="kt">float</span> <span class="n">circleShape</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="n">circlePosition</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">combination</span> <span class="o">=</span> <span class="cm">/* combination calculation here */</span><span class="p">;</span>

                <span class="k">return</span> <span class="n">combination</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">float4</span> <span class="n">_InsideColor</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">_OutsideColor</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">_LineDistance</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">_LineThickness</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">_SubLines</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">_SubLineThickness</span><span class="p">;</span>

            <span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
                <span class="kt">float</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">scene</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">xz</span><span class="p">);</span>
                <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">_InsideColor</span><span class="p">,</span> <span class="n">_OutsideColor</span><span class="p">,</span> <span class="n">step</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dist</span><span class="p">));</span>

                <span class="kt">float</span> <span class="n">distanceChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">majorLineDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">frac</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="n">_LineDistance</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_LineDistance</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">majorLines</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">_LineThickness</span> <span class="o">-</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">_LineThickness</span> <span class="o">+</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">majorLineDistance</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">distanceBetweenSubLines</span> <span class="o">=</span> <span class="n">_LineDistance</span> <span class="o">/</span> <span class="n">_SubLines</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">subLineDistance</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">frac</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="n">distanceBetweenSubLines</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">distanceBetweenSubLines</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">subLines</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">_SubLineThickness</span> <span class="o">-</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">_SubLineThickness</span> <span class="o">+</span> <span class="n">distanceChange</span><span class="p">,</span> <span class="n">subLineDistance</span><span class="p">);</span>

                <span class="k">return</span> <span class="n">col</span> <span class="o">*</span> <span class="n">majorLines</span> <span class="o">*</span> <span class="n">subLines</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">ENDCG</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">FallBack</span> <span class="s">"Standard"</span> <span class="c1">//fallback adds a shadow pass so we get shadows on other objects</span>
<span class="p">}</span>
</code></pre></div></div>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
