<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Single Step Toon Light</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="I thought about how to make a toon shader and this is the result. There are obviously many different toon styles, so this is just one possiblity of m..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Single Step Toon Light">
<meta itemprop="description" content="I thought about how to make a toon shader and this is the result. There are obviously many different toon styles, so this is just one possiblity of m...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/031/Result.gif">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Single Step Toon Light">
<meta name="twitter:description" content="I thought about how to make a toon shader and this is the result. There are obviously many different toon styles, so this is just one possiblity of m...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/031/Result.gif">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/031/Result.gif">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/10/20/single-step-toon.html">

<!-- Open Graph data -->
<meta property="og:title" content="Single Step Toon Light" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/10/20/single-step-toon.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/031/Result.gif" />

<meta property="og:description" content="I thought about how to make a toon shader and this is the result. There are obviously many different toon styles, so this is just one possiblity of m..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-10-20T00:00:00+02:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/10/20/single-step-toon.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">Single Step Toon Light</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-10-20T00:00:00+02:00" itemprop="datePublished">
          
          Oct 20, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Single Step Toon Light</h1>
    <p class="post-meta">
      <time datetime="2018-10-20T00:00:00+02:00" itemprop="datePublished">
        
        Oct 20, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#antialiased-step">Antialiased Step</a></li>
  <li><a href="#shadows">Shadows</a></li>
  <li><a href="#colors">Colors</a></li>
  <li><a href="#source">Source</a></li>
</ul>

  <div itemprop="articleBody">
    <p>I thought about how to make a toon shader and this is the result. There are obviously many different toon styles, so this is just one possiblity of many, but even if it’s not the result you want in your game this tutorial can give you some insight in how I work and how to do stuff with shaders. The main advantage for me to use this toon shader in opposition to one that reads from ramp texures is that I can dynamically change the parameters without editing a texture first.</p>

<p>I explain the basics of custom lighting models more indepth in <a href="/2018/06/02/custom-lighting.html">this tutorial</a>, but you should be fine if you know the basics of surface shaders in unity.</p>

<p><img src="/assets/images/posts/031/Result.gif" alt="" /></p>

<h2 id="antialiased-step">Antialiased Step</h2>

<p>We start the shader by using a basic surface shader.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">CGPROGRAM</span>

<span class="c1">//the shader is a surface shader, meaning that it will be extended by unity in the background to have fancy lighting and other features</span>
<span class="c1">//our surface shader function is called surf and we use our custom lighting model</span>
<span class="c1">//fullforwardshadows makes sure unity adds the shadow passes the shader might need</span>
<span class="cp">#pragma surface surf Standard fullforwardshadows
#pragma target 3.0
</span>
<span class="kt">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
<span class="n">half3</span> <span class="n">_Emission</span><span class="p">;</span>

<span class="c1">//input struct which is automatically filled by unity</span>
<span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
    <span class="n">float2</span> <span class="n">uv_MainTex</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">//the surface shader function which sets parameters the lighting function then uses</span>
<span class="kt">void</span> <span class="nf">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutput</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//sample and tint albedo texture</span>
    <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv_MainTex</span><span class="p">);</span>
    <span class="n">col</span> <span class="o">*=</span> <span class="n">_Color</span><span class="p">;</span>
    <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">col</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>

    <span class="n">o</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="n">_Emission</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ENDCG</span>
</code></pre></div></div>

<p>Then we change the lighting model to our own and create a new function to match it. The function has to be called Lighting<code class="language-plaintext highlighter-rouge">OurLightingModelName</code>. The lighting model then has the name of the function name after <code class="language-plaintext highlighter-rouge">Lighting</code>. We’ll take the <code class="language-plaintext highlighter-rouge">SurfaceOutput</code> of the surf function, the light direction, the view direction and the shadow attenuation as parameters for our lighing function to calculate the lighting.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma surface surf Stepped fullforwardshadows
</span></code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//our lighting function. Will be called once per light</span>
<span class="n">float4</span> <span class="nf">LightingStepped</span><span class="p">(</span><span class="n">SurfaceOutput</span> <span class="n">s</span><span class="p">,</span> <span class="n">float3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">half3</span> <span class="n">viewDir</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shadowAttenuation</span><span class="p">){</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The most basic start to most lighting functions is to calculate how much the surface point points towards the light we’re calculating the illumination for. For that we’ll use use the dot function, it returns 1 when the vectors you pass it point in the same direction and -1 if they’re opposing if they’re both normalised. In this case the vectors are normalised when they’re passed into the function so we don’t have to worry about that. For the normal we simply use use normal of the surface output, it’s also prepared by unity to already be in worldspace, just like the light and view direction.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//our lighting function. Will be called once per light</span>
<span class="n">float4</span> <span class="nf">LightingStepped</span><span class="p">(</span><span class="n">SurfaceOutput</span> <span class="n">s</span><span class="p">,</span> <span class="n">float3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">half3</span> <span class="n">viewDir</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shadowAttenuation</span><span class="p">){</span>
    <span class="c1">//how much surface normal points towards the light</span>
    <span class="n">flaot</span> <span class="n">towardsLight</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">towardsLight</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/031/Dot.png" alt="" /></p>

<p>Then, to get a hard cut for the toon effect, we can use a <code class="language-plaintext highlighter-rouge">step</code> function, it’ll return 0 if the first argument is greater, otherwise 1. The dot function returns 0 when the vectors are orthogonal which is the case at the half point of our surface. The side thats away from the light has negative values and the side towards the light positive ones. That’s why we pass the <code class="language-plaintext highlighter-rouge">towardsLight</code> parameter as the second parameter into the step function and 0 as the first.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//our lighting function. Will be called once per light</span>
<span class="n">float4</span> <span class="nf">LightingStepped</span><span class="p">(</span><span class="n">SurfaceOutput</span> <span class="n">s</span><span class="p">,</span> <span class="n">float3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">half3</span> <span class="n">viewDir</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shadowAttenuation</span><span class="p">){</span>
    <span class="c1">//how much does the normal point towards the light?</span>
    <span class="kt">float</span> <span class="n">towardsLight</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">step</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">towardsLight</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">lightIntensity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/031/Step.png" alt="" /></p>

<p>Now we have a nice hard cut, but ironically it’s too hard, we get pixel steps often called aliasing. We can avoid aliasing by not jumping from 0 to 1 at one point, instead we interpolate between them over the range of one pixel. For that we’ll have to find out how much the value we’re evaluating (<code class="language-plaintext highlighter-rouge">towardsLight</code>) changes in a single pixel. We get that value by passing the variable to fwidth. The fwidth function will compare the value to the same variable in neighboring pixels and tell us how much it changes approximately. When we know the change of the variable we can then exchange step with smoothstep, it takes 3 parameters, the first two mark the minimum(where the output value is 0) and maximum (where the output value is 1). So we pass 0 as the first value here, the value change as the second one and the value of how much the surface points at the light as the third parameter. With this we have almost the same result as previously, but the edge looks less jaggy.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//our lighting function. Will be called once per light</span>
<span class="n">float4</span> <span class="nf">LightingStepped</span><span class="p">(</span><span class="n">SurfaceOutput</span> <span class="n">s</span><span class="p">,</span> <span class="n">float3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">half3</span> <span class="n">viewDir</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shadowAttenuation</span><span class="p">){</span>
    <span class="c1">//how much does the normal point towards the light?</span>
    <span class="kt">float</span> <span class="n">towardsLight</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">towardsLightChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">towardsLight</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">towardsLightChange</span><span class="p">,</span> <span class="n">towardsLight</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">lightIntensity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/031/Smoothstep.png" alt="" /></p>

<h2 id="shadows">Shadows</h2>

<p>We use the shadowAttenuation variable to add shadows to our shader, but when we just it by itself it’s too soft, something that clashes a bit with the style of this shader.</p>

<p><img src="/assets/images/posts/031/Atten.png" alt="" /></p>

<p>We can give it the same treatment we gave the dot value. First find out how much the variable changes in the neighboring pixels and then do a smoothstep. Because we want to cut the shadow at the middle of the gradient and not just before it’s completely black, we’ll half the pixel change value and then use <code class="language-plaintext highlighter-rouge">0.5 - changevalue</code> as the minimum and <code class="language-plaintext highlighter-rouge">0.5 + changeValue</code> as the maximum.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">attenuationChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">shadowAttenuation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">-</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="n">shadowAttenuation</span><span class="p">);</span>

<span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">lightIntensity</span> <span class="o">*</span> <span class="n">shadow</span><span class="p">;</span>

<span class="k">return</span> <span class="n">lightIntensity</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/031/Shadow.png" alt="" /></p>

<p>The problem with hardening the shadows like this is that point lights also have their falloff encoded into the shadow attenuation property. We can sidestep this by branching our shader and doing the smoothstep from 0 to the change instead of around 0.5. This will lead to some artefacts, but at least we can have shadows for point lights. We do the branching by writing compiler directives into the shader. If the flag <code class="language-plaintext highlighter-rouge">USING_DIRECTIONAL_LIGHT</code> is defined, the shader is going to put the border around 0.5, just like we did so far and if it isn’t it’s going to put the border at 0.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef USING_DIRECTIONAL_LIGHT
</span>    <span class="kt">float</span> <span class="n">attenuationChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">shadowAttenuation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">-</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="n">shadowAttenuation</span><span class="p">);</span>
<span class="cp">#else
</span>    <span class="kt">float</span> <span class="n">attenuationChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">shadowAttenuation</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="n">shadowAttenuation</span><span class="p">);</span>
<span class="cp">#endif
</span>    <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">lightIntensity</span> <span class="o">*</span> <span class="n">shadow</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/031/PointShadows.png" alt="" /></p>

<h2 id="colors">Colors</h2>

<p>Now that we have a clear differentiation between shadow and light, we can add colors to the shader. The Color on the light side of the object will be the diffuse color of the object. The color on the shadowed side is the diffuse color multiplied a new shadow color, this way we can tint the shadow in any color we want. The result of the combination of light and shadow side will then we multiplied by the light color. We could also only multiply the light side color with the light color, but this can lead to the dark side being brighter than the bright side for low intensity lights which would be odd. We also get the alpha from the surface output struct to use it as the alpha channel of the output color.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Properties</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">Header</span><span class="p">(</span><span class="n">Base</span> <span class="n">Parameters</span><span class="p">)]</span>
    <span class="n">_Color</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="p">[</span><span class="n">HDR</span><span class="p">]</span> <span class="n">_Emission</span> <span class="p">(</span><span class="s">"Emission"</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="p">[</span><span class="n">Header</span><span class="p">(</span><span class="n">Lighting</span> <span class="n">Parameters</span><span class="p">)]</span>
    <span class="n">_ShadowTint</span> <span class="p">(</span><span class="s">"Shadow Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//global hlsl variable</span>

<span class="n">float3</span> <span class="n">_ShadowTint</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float3</span> <span class="n">shadowColor</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">*</span> <span class="n">_ShadowTint</span><span class="p">;</span>
<span class="n">float4</span> <span class="n">color</span><span class="p">;</span>
<span class="n">color</span><span class="p">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">shadowColor</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">Albedo</span><span class="p">,</span> <span class="n">lightIntensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">_LightColor0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Alpha</span><span class="p">;</span>
<span class="k">return</span> <span class="n">color</span><span class="p">;</span>
</code></pre></div></div>

<p>With this we have a shader with simple shading with a hard cut.</p>

<h2 id="source">Source</h2>

<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/031_StepToon/SteppedToonLighting.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/031_StepToon/SteppedToonLighting.shader</a></li>
</ul>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/031_SteppedToon"</span> <span class="p">{</span>
    <span class="c1">//show values to edit in inspector</span>
    <span class="n">Properties</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">Header</span><span class="p">(</span><span class="n">Base</span> <span class="n">Parameters</span><span class="p">)]</span>
        <span class="n">_Color</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
        <span class="p">[</span><span class="n">HDR</span><span class="p">]</span> <span class="n">_Emission</span> <span class="p">(</span><span class="s">"Emission"</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">Header</span><span class="p">(</span><span class="n">Lighting</span> <span class="n">Parameters</span><span class="p">)]</span>
        <span class="n">_ShadowTint</span> <span class="p">(</span><span class="s">"Shadow Color"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">SubShader</span> <span class="p">{</span>
        <span class="c1">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry</span>
        <span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

        <span class="n">CGPROGRAM</span>

        <span class="c1">//the shader is a surface shader, meaning that it will be extended by unity in the background to have fancy lighting and other features</span>
        <span class="c1">//our surface shader function is called surf and we use our custom lighting model</span>
        <span class="c1">//fullforwardshadows makes sure unity adds the shadow passes the shader might need</span>
        <span class="cp">#pragma surface surf Stepped fullforwardshadows
</span>        <span class="cp">#pragma target 3.0
</span>
        <span class="kt">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
        <span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>
        <span class="n">half3</span> <span class="n">_Emission</span><span class="p">;</span>

        <span class="n">float3</span> <span class="n">_ShadowTint</span><span class="p">;</span>

        <span class="c1">//our lighting function. Will be called once per light</span>
        <span class="n">float4</span> <span class="n">LightingStepped</span><span class="p">(</span><span class="n">SurfaceOutput</span> <span class="n">s</span><span class="p">,</span> <span class="n">float3</span> <span class="n">lightDir</span><span class="p">,</span> <span class="n">half3</span> <span class="n">viewDir</span><span class="p">,</span> <span class="kt">float</span> <span class="n">shadowAttenuation</span><span class="p">){</span>
            <span class="c1">//how much does the normal point towards the light?</span>
            <span class="kt">float</span> <span class="n">towardsLight</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Normal</span><span class="p">,</span> <span class="n">lightDir</span><span class="p">);</span>
            <span class="c1">// make the lighting a hard cut</span>
            <span class="kt">float</span> <span class="n">towardsLightChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">towardsLight</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">towardsLightChange</span><span class="p">,</span> <span class="n">towardsLight</span><span class="p">);</span>

        <span class="cp">#ifdef USING_DIRECTIONAL_LIGHT
</span>            <span class="c1">//for directional lights, get a hard vut in the middle of the shadow attenuation</span>
            <span class="kt">float</span> <span class="n">attenuationChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">shadowAttenuation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">-</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="o">+</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="n">shadowAttenuation</span><span class="p">);</span>
        <span class="cp">#else
</span>            <span class="c1">//for other light types (point, spot), put the cutoff near black, so the falloff doesn't affect the range</span>
            <span class="kt">float</span> <span class="n">attenuationChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">shadowAttenuation</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">shadow</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">attenuationChange</span><span class="p">,</span> <span class="n">shadowAttenuation</span><span class="p">);</span>
        <span class="cp">#endif
</span>            <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">lightIntensity</span> <span class="o">*</span> <span class="n">shadow</span><span class="p">;</span>

            <span class="c1">//calculate shadow color and mix light and shadow based on the light. Then taint it based on the light color</span>
            <span class="n">float3</span> <span class="n">shadowColor</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">*</span> <span class="n">_ShadowTint</span><span class="p">;</span>
            <span class="n">float4</span> <span class="n">color</span><span class="p">;</span>
            <span class="n">color</span><span class="p">.</span><span class="n">rgb</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">shadowColor</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">Albedo</span><span class="p">,</span> <span class="n">lightIntensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">_LightColor0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
            <span class="n">color</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">Alpha</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">color</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="c1">//input struct which is automatically filled by unity</span>
        <span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
            <span class="n">float2</span> <span class="n">uv_MainTex</span><span class="p">;</span>
        <span class="p">};</span>

        <span class="c1">//the surface shader function which sets parameters the lighting function then uses</span>
        <span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutput</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//sample and tint albedo texture</span>
            <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv_MainTex</span><span class="p">);</span>
            <span class="n">col</span> <span class="o">*=</span> <span class="n">_Color</span><span class="p">;</span>
            <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">col</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>

            <span class="n">o</span><span class="p">.</span><span class="n">Emission</span> <span class="o">=</span> <span class="n">_Emission</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">ENDCG</span>
    <span class="p">}</span>
    <span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I hope it’s interresting for you to you to see how to do simple stuff like antialiased lighting and that it’ll help you in writing your own cool shaders. 💕</p>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
