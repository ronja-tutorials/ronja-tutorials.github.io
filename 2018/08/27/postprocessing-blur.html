<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Blur Postprocessing Effect</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="Summary A effect that’s useful for example to show exhaustion or to make transitions is a blur. To blur the screen we take the average of the surroun..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Blur Postprocessing Effect">
<meta itemprop="description" content="Summary A effect that’s useful for example to show exhaustion or to make transitions is a blur. To blur the screen we take the average of the surroun...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/023/Result.gif">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Blur Postprocessing Effect">
<meta name="twitter:description" content="Summary A effect that’s useful for example to show exhaustion or to make transitions is a blur. To blur the screen we take the average of the surroun...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/023/Result.gif">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/023/Result.gif">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/08/27/postprocessing-blur.html">

<!-- Open Graph data -->
<meta property="og:title" content="Blur Postprocessing Effect" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/08/27/postprocessing-blur.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/023/Result.gif" />

<meta property="og:description" content="Summary A effect that’s useful for example to show exhaustion or to make transitions is a blur. To blur the screen we take the average of the surroun..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-08-27T00:00:00+02:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/08/27/postprocessing-blur.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">Blur Postprocessing Effect</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-08-27T00:00:00+02:00" itemprop="datePublished">
          
          Aug 27, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Blur Postprocessing Effect</h1>
    <p class="post-meta">
      <time datetime="2018-08-27T00:00:00+02:00" itemprop="datePublished">
        
        Aug 27, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#summary">Summary</a></li>
  <li><a href="#boxblur">Boxblur</a>
    <ul>
      <li><a href="#1d-blur">1D Blur</a></li>
      <li><a href="#2d-blur">2D Blur</a></li>
      <li><a href="#customize-sample-amount">Customize Sample Amount</a></li>
    </ul>
  </li>
  <li><a href="#gaussian-blur">Gaussian Blur</a></li>
  <li><a href="#source">Source</a></li>
</ul>

  <div itemprop="articleBody">
    <h2 id="summary">Summary</h2>
<p>A effect that’s useful for example to show exhaustion or to make transitions is a blur. To blur the screen we take the average of the surrounding pixels. You can use the effect in many places, but the easiest and most straightforward is probably as a postprocessing effect, so it’s best for you to know how to write <a href="/2018/06/23/postprocessing-basics.html">postprocessing effects</a> before doing this tutorial.</p>

<p><img src="/assets/images/posts/023/Result.gif" alt="" /></p>

<h2 id="boxblur">Boxblur</h2>
<p>The easiest form of a blur is a box blur, it just takes the average of a square area and displays it. To access the many different points on the source texture we just iterate over them with a for loop. After reading the color at the different positions we add it to a color variable. And then after adding all of the texture colors we divide by the amount of samples we added to get the average.</p>

<p>We can use the shader with the postprocessing script we made for the previous tutorial.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the fragment shader</span>
<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
    <span class="c1">//init color variable</span>
    <span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="n">index</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//add color at position to color</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//divide the sum of values by the amount of samples</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="1d-blur">1D Blur</h3>
<p>Because we’re reading the texture 10 times at the same point, our shader doesn’t change anything yet, so the next step is to actually read from different positions on the screen. For this we add a new property and global variable called blur size. This way we can change how much the shader will blur the image. The variable will change the size of the rectangle we take the colors from relative to the screen. By taking the size relative to the screen instead of setting it in pixels ensures that the blurred image will look similar in different resolutions.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//show values to edit in inspector</span>
<span class="n">Properties</span><span class="p">{</span>
    <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span><span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_BlurSize</span><span class="p">(</span><span class="s">"Blur Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">_BlurSize</span><span class="p">;</span>
</code></pre></div></div>

<p>With this new value we can calculate a custom uv position for each sample. To do that we divide the index of the loop by the amount of overall samples minus 1 (in our case 9), that gives us a range from 0 on the first sample to 1 on the last sample. To move that range to be around the point and not on the point we then subtract 0.5 so it’s from -0.5 to +0.5. Then we also multiply that result with the new blur size variable to make it customizable.</p>

<p>After we calculate that value we add it as a y value to the existing uv coordinate.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//iterate over blur samples</span>
<span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">index</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span><span class="n">index</span><span class="o">++</span><span class="p">){</span>
    <span class="c1">//get uv coordinate of sample</span>
    <span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="mi">9</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span><span class="p">);</span>
    <span class="c1">//add color at position to color</span>
    <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/023/VerticalBlur.gif" alt="" /></p>

<p>That gives us a blur along the y axis, but we want to blur along the x axis too. One way to do this would be to nest our for loop in another for loop and iterate over all points in the square, but that’s very important and theres a better method. We can also take the result of the blit we just did and then do a second one along the x axis. So by blurring the image which is blurred along the y axis along the x axis we get a result which is the average of a square.</p>

<h3 id="2d-blur">2D Blur</h3>
<p>For the second blit we write a completely new shader pass. First we copy the old one, then we change it by moving the offset scalar value to the x component of the offset variable instead of the y component. Another change we make is that we multiply the offset by the inverse of the aspect ratio, that way the distance between samples is the same in the vertical and horizontal pass.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the fragment shader</span>
<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
    <span class="c1">//calculate aspect ratio</span>
    <span class="kt">float</span> <span class="n">invAspect</span> <span class="o">=</span> <span class="n">_ScreenParams</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">_ScreenParams</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="c1">//init color variable</span>
    <span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//iterate over blur samples</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//get uv coordinate of sample</span>
        <span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">((</span><span class="n">index</span><span class="o">/</span><span class="mi">9</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span> <span class="o">*</span> <span class="n">invAspect</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="c1">//add color at position to color</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//divide the sum of values by the amount of samples</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To use both passes we have to change our C# script now. Because we have a temporary result after the vertical and before the horizontal pass, we have to use a new rendertexture. We use the <code class="language-plaintext highlighter-rouge">RenderTexture.GetTemporary</code> utility for that. With this function we can request a rendertexture of a size and unity will manage the pooling in the background. Then we call our first blit function an additional fourth parameter <code class="language-plaintext highlighter-rouge">0</code>. That fourth parameter is the pass of the shader and in our shader the first pass is our horizontal pass. The blit has has to read from the source texture and write into our temporary texture. Then after the first blit we do another one which will read from the temporary, vertically blurred,  texture and write into the destination texture and will use the second pass with the index <code class="language-plaintext highlighter-rouge">1</code> to blur vertically. After blurring the texture we release the temporary texture again so other scripts can use it if they should need it.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//method which is automatically called by unity after the camera is done rendering</span>
<span class="kt">void</span> <span class="nf">OnRenderImage</span><span class="p">(</span><span class="n">RenderTexture</span> <span class="n">source</span><span class="p">,</span> <span class="n">RenderTexture</span> <span class="n">destination</span><span class="p">){</span>
    <span class="c1">//draws the pixels from the source texture to the destination texture</span>
    <span class="n">var</span> <span class="n">temporaryTexture</span> <span class="o">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="n">GetTemporary</span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">source</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
    <span class="n">Graphics</span><span class="p">.</span><span class="n">Blit</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">temporaryTexture</span><span class="p">,</span> <span class="n">postprocessMaterial</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">Graphics</span><span class="p">.</span><span class="n">Blit</span><span class="p">(</span><span class="n">temporaryTexture</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">postprocessMaterial</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">RenderTexture</span><span class="p">.</span><span class="n">ReleaseTemporary</span><span class="p">(</span><span class="n">temporaryTexture</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/023/BoxBlur.gif" alt="" /></p>

<h3 id="customize-sample-amount">Customize Sample Amount</h3>
<p>With this we have a simple blur. But I’d like to make the amount of samples also customizable. We can’t do that with a simple variable because unity has to know when it compiles how many samples there will be. That’s because reading from textures in a loop isn’t /really/ possible. The reason we can still do it is that the loop is so predictable that the shader compiler can “unroll” it. So in the compiled code the code in the loop is just put back to back multiple times with the parameters of the loop that change.</p>

<p>The way to give unity variables that it knows during shader compilation is via <code class="language-plaintext highlighter-rouge">#define</code> definitions. So we add a defintion for a variable called samples and give it the value of 10 in the cgprogram outside of functions. Then in the fragment shader we replace everything that depends on the amount of samples with this new variable. It’s important now that we make those changes in both shader passes!</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define SAMPLES 10
</span></code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the fragment shader</span>
<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
    <span class="c1">//init color variable</span>
    <span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//iterate over blur samples</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">SAMPLES</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//get uv coordinate of sample</span>
        <span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="p">(</span><span class="n">SAMPLES</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span><span class="p">);</span>
        <span class="c1">//add color at position to color</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">//divide the sum of values by the amount of samples</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="n">SAMPLES</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this change it’s easy to adjust the samples in the code, but we can go one step further and make them changable in the inspector too. First we add a property with the <code class="language-plaintext highlighter-rouge">KeywordEnum</code> propertydrawer, with it the property shows the different possibilities and sets the according keywords in the shader.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//show values to edit in inspector</span>
<span class="n">Properties</span><span class="p">{</span>
    <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span><span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_BlurSize</span><span class="p">(</span><span class="s">"Blur Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">KeywordEnum</span><span class="p">(</span><span class="n">Low</span><span class="p">,</span> <span class="n">Medium</span><span class="p">,</span> <span class="n">High</span><span class="p">)]</span> <span class="n">_Samples</span> <span class="p">(</span><span class="s">"Sample amount"</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then in the cgprogram we can declare that the shader will be compiled into multiple possibilitied with <code class="language-plaintext highlighter-rouge">multi_compile</code>. The keywords of the multicompile are the property name plus the different possibilities we entered.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma multi_compile _SAMPLES_LOW _SAMPLES_MEDIUM _SAMPLES_HIGH
</span></code></pre></div></div>

<p>With this set up we can set up what will happen depending on the active keyword. In this case we will only change the samples variable depending on the keyword. Here it’s again important to add the multicompile declaration and the different sample amounts to both shader passes!</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if _SAMPLES_LOW
</span>    <span class="cp">#define SAMPLES 10
#elif _SAMPLES_MEDIUM
</span>    <span class="cp">#define SAMPLES 30
#else
</span>    <span class="cp">#define SAMPLES 100
#endif
</span></code></pre></div></div>

<p><img src="/assets/images/posts/023/QualitySettings.gif" alt="" /></p>

<p>With this change we can now chage the quality how it fits and have Implemented a box blur shader successfully.</p>

<h2 id="gaussian-blur">Gaussian Blur</h2>
<p>A more complex way to blur a image is to do a gaussian blur. It’s similar to the box blur, but gives the pixels with a smaller offset to the center a lower priority. We can calculate the weight of every pixel with a gaussian function, it looks like this:</p>

<p><img src="/assets/images/posts/023/Gauss.svg" alt="" /></p>

<p>We need 2 parameters for the function, the distance from the center x and the standart deviation σ. We already have x, because we used it for calculating the box blur. the standart deviation will be a new property. We will also add another new property which will allow us to toggle wether the shader uses gauss or box blur. The toggle propertydrawer allows us to show checkboxes in the inspector and when we pass it a shader feature it will also activate and deactivate that. Shader features act just like multi compile shaders, but it’s easier to just have one variable and turn it on and off.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//show values to edit in inspector</span>
<span class="n">Properties</span><span class="p">{</span>
    <span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span><span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
    <span class="n">_BlurSize</span><span class="p">(</span><span class="s">"Blur Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">KeywordEnum</span><span class="p">(</span><span class="n">BoxLow</span><span class="p">,</span> <span class="n">BoxMedium</span><span class="p">,</span> <span class="n">BoxHigh</span><span class="p">,</span> <span class="n">GaussLow</span><span class="p">,</span> <span class="n">GaussHigh</span><span class="p">)]</span> <span class="n">_Samples</span> <span class="p">(</span><span class="s">"Sample amount"</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">[</span><span class="n">Toggle</span><span class="p">(</span><span class="n">GAUSS</span><span class="p">)]</span> <span class="n">_Gauss</span> <span class="p">(</span><span class="s">"Gaussian Blur"</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_StandardDeviation</span><span class="p">(</span><span class="s">"Standard Deviation (Gauss only)"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">02</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#pragma shader_feature GAUSS
</span></code></pre></div></div>

<p>Another thing we need for the gaussian function is pi and Euler’s number, so we also add them as defined constants.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define PI 3.14159265359
#define E 2.71828182846
</span></code></pre></div></div>

<p>By bringing in the gauss function we’re not sure what the sum of all samples will be anymore, so we introduce a new local variable for the sum. If we’re doing a gauss blur, we init the variable as 0 and add the gauss values in the for loop. When using a box blur we can continue to use the sample count as the sum of all sample influcences.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#if GAUSS
</span>    <span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">;</span>
<span class="cp">#endif
</span></code></pre></div></div>

<p>Then we rewrite the part of the shader in the for loop. We first save the scalar offset in it’s own variable and then build the uv coordinated based on it, that way we can use it later in the gaussian function.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">SAMPLES</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="p">(</span><span class="n">SAMPLES</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span><span class="p">;</span>
    <span class="c1">//get uv coordinate of sample</span>
    <span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="cp">#if !GAUSS
</span>    <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
<span class="cp">#else
</span>    <span class="c1">//gauss stuff</span>
<span class="cp">#endif
</span><span class="p">}</span>
</code></pre></div></div>

<p>With this setup we can now also implement the gaussian blur. First we calculate the square of the standard deviation, because it’s used twice in the function. Then we calculate the function itself. First the left half, we divide one by the square root of two times pi times the square of the standard deviation. Then we multiply it with the right part which is the Euler’s number to the power of minus offset squared divided by 2 times the standard deviation squared.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//calculate the result of the gaussian function</span>
<span class="kt">float</span> <span class="n">stDevSquared</span> <span class="o">=</span> <span class="n">_StandardDeviation</span><span class="o">*</span><span class="n">_StandardDeviation</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">gauss</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">))</span> <span class="o">*</span> <span class="nf">pow</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="o">-</span><span class="p">((</span><span class="n">offset</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">)));</span>
</code></pre></div></div>

<p>Then once we have that value we add it to our sum of all values and we multiply the texture color with it and add that to the sum of all colors. Once that’s done we can add those changes to the other pass too and we have a working gaussian blur.</p>

<p>One last thing about the gaussian blur is that it breaks when the standart deviation is 0, so we add a tiny failsafe at the beginning of the fragment shader to just not do any blurring if the standart deviation is 0.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the fragment shader</span>
<span class="n">fixed4</span> <span class="nf">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
<span class="cp">#if GAUSS
</span>    <span class="c1">//failsafe so we can use turn off the blur by setting the deviation to 0</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_StandardDeviation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
<span class="cp">#endif
</span>    <span class="c1">//init color variable</span>
    <span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#if GAUSS
</span>    <span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#else
</span>    <span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">;</span>
<span class="cp">#endif
</span>    <span class="c1">//iterate over blur samples</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">SAMPLES</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
        <span class="c1">//get the offset of the sample</span>
        <span class="kt">float</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="p">(</span><span class="n">SAMPLES</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span><span class="p">;</span>
        <span class="c1">//get uv coordinate of sample</span>
        <span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
    <span class="cp">#if !GAUSS
</span>        <span class="c1">//simply add the color if we don't have a gaussian blur (box)</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
    <span class="cp">#else
</span>        <span class="c1">//calculate the result of the gaussian function</span>
        <span class="kt">float</span> <span class="n">stDevSquared</span> <span class="o">=</span> <span class="n">_StandardDeviation</span><span class="o">*</span><span class="n">_StandardDeviation</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">gauss</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">))</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="o">-</span><span class="p">((</span><span class="n">offset</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">)));</span>
        <span class="c1">//add result to sum</span>
        <span class="n">sum</span> <span class="o">+=</span> <span class="n">gauss</span><span class="p">;</span>
        <span class="c1">//multiply color with influence from gaussian function and add it to sum color</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
    <span class="cp">#endif
</span>    <span class="p">}</span>
    <span class="c1">//divide the sum of values by the amount of samples</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="n">sum</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
<span class="err">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/023/Result.gif" alt="" /></p>

<p>There are two mayor improvements that could be done to this shader that come to my mind, but I won’t get into right here. First, you could put some of the code into a include file, that way a lot of the code that’s in both shader passes only has to be written once and we can use it in both passes. Secondly you could calculate the results of the gaussian function in C# and then pass them to the shader, calculating them in the shader is pretty expensive.</p>

<h2 id="source">Source</h2>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="c1">//behaviour which should lie on the same gameobject as the main camera</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PostprocessingBlur</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
	<span class="c1">//material that's applied when doing postprocessing</span>
	<span class="p">[</span><span class="n">SerializeField</span><span class="p">]</span>
	<span class="k">private</span> <span class="n">Material</span> <span class="n">postprocessMaterial</span><span class="p">;</span>

	<span class="c1">//method which is automatically called by unity after the camera is done rendering</span>
	<span class="k">void</span> <span class="nf">OnRenderImage</span><span class="p">(</span><span class="n">RenderTexture</span> <span class="n">source</span><span class="p">,</span> <span class="n">RenderTexture</span> <span class="n">destination</span><span class="p">){</span>
		<span class="c1">//draws the pixels from the source texture to the destination texture</span>
		<span class="kt">var</span> <span class="n">temporaryTexture</span> <span class="p">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">GetTemporary</span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">source</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
		<span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">temporaryTexture</span><span class="p">,</span> <span class="n">postprocessMaterial</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
		<span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="n">temporaryTexture</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">postprocessMaterial</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
		<span class="n">RenderTexture</span><span class="p">.</span><span class="nf">ReleaseTemporary</span><span class="p">(</span><span class="n">temporaryTexture</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/023_Postprocessing_Blur"</span><span class="p">{</span>
	<span class="c1">//show values to edit in inspector</span>
	<span class="n">Properties</span><span class="p">{</span>
		<span class="p">[</span><span class="n">HideInInspector</span><span class="p">]</span><span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">2</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
		<span class="n">_BlurSize</span><span class="p">(</span><span class="s">"Blur Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="p">[</span><span class="n">KeywordEnum</span><span class="p">(</span><span class="n">Low</span><span class="p">,</span> <span class="n">Medium</span><span class="p">,</span> <span class="n">High</span><span class="p">)]</span> <span class="n">_Samples</span> <span class="p">(</span><span class="s">"Sample amount"</span><span class="p">,</span> <span class="n">Float</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="p">[</span><span class="n">Toggle</span><span class="p">(</span><span class="n">GAUSS</span><span class="p">)]</span> <span class="n">_Gauss</span> <span class="p">(</span><span class="s">"Gaussian Blur"</span><span class="p">,</span> <span class="kt">float</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="p">[</span><span class="n">PowerSlider</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span><span class="n">_StandardDeviation</span><span class="p">(</span><span class="s">"Standard Deviation (Gauss only)"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mo">00</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">02</span>
	<span class="p">}</span>

	<span class="n">SubShader</span><span class="p">{</span>
		<span class="c1">// markers that specify that we don't need culling </span>
		<span class="c1">// or reading/writing to the depth buffer</span>
		<span class="n">Cull</span> <span class="n">Off</span>
		<span class="n">ZWrite</span> <span class="n">Off</span> 
		<span class="n">ZTest</span> <span class="n">Always</span>


		<span class="c1">//Vertical Blur</span>
		<span class="n">Pass</span><span class="p">{</span>
			<span class="n">CGPROGRAM</span>
			<span class="c1">//include useful shader functions</span>
			<span class="cp">#include "UnityCG.cginc"
</span>
			<span class="c1">//define vertex and fragment shader</span>
			<span class="cp">#pragma vertex vert
</span>			<span class="cp">#pragma fragment frag
</span>
			<span class="cp">#pragma multi_compile _SAMPLES_LOW _SAMPLES_MEDIUM _SAMPLES_HIGH
</span>			<span class="cp">#pragma shader_feature GAUSS
</span>
			<span class="c1">//texture and transforms of the texture</span>
			<span class="kt">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">_BlurSize</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">_StandardDeviation</span><span class="p">;</span>

			<span class="cp">#define PI 3.14159265359
</span>			<span class="cp">#define E 2.71828182846
</span>
		<span class="cp">#if _SAMPLES_LOW
</span>			<span class="cp">#define SAMPLES 10
</span>		<span class="cp">#elif _SAMPLES_MEDIUM
</span>			<span class="cp">#define SAMPLES 30
</span>		<span class="cp">#else
</span>			<span class="cp">#define SAMPLES 100
</span>		<span class="cp">#endif
</span>
			<span class="c1">//the object data that's put into the vertex shader</span>
			<span class="k">struct</span> <span class="n">appdata</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the data that's used to generate fragments and can be read by the fragment shader</span>
			<span class="k">struct</span> <span class="n">v2f</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the vertex shader</span>
			<span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">){</span>
				<span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
				<span class="c1">//convert the vertex positions from object space to clip space so they can be rendered</span>
				<span class="n">o</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
				<span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">o</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="c1">//the fragment shader</span>
			<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
			<span class="cp">#if GAUSS
</span>				<span class="c1">//failsafe so we can use turn off the blur by setting the deviation to 0</span>
				<span class="k">if</span><span class="p">(</span><span class="n">_StandardDeviation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
			<span class="cp">#endif
</span>				<span class="c1">//init color variable</span>
				<span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cp">#if GAUSS
</span>				<span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cp">#else
</span>				<span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">;</span>
			<span class="cp">#endif
</span>				<span class="c1">//iterate over blur samples</span>
				<span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">SAMPLES</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
					<span class="c1">//get the offset of the sample</span>
					<span class="kt">float</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="p">(</span><span class="n">SAMPLES</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span><span class="p">;</span>
					<span class="c1">//get uv coordinate of sample</span>
					<span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
				<span class="cp">#if !GAUSS
</span>					<span class="c1">//simply add the color if we don't have a gaussian blur (box)</span>
					<span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
				<span class="cp">#else
</span>					<span class="c1">//calculate the result of the gaussian function</span>
					<span class="kt">float</span> <span class="n">stDevSquared</span> <span class="o">=</span> <span class="n">_StandardDeviation</span><span class="o">*</span><span class="n">_StandardDeviation</span><span class="p">;</span>
					<span class="kt">float</span> <span class="n">gauss</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">))</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="o">-</span><span class="p">((</span><span class="n">offset</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">)));</span>
					<span class="c1">//add result to sum</span>
					<span class="n">sum</span> <span class="o">+=</span> <span class="n">gauss</span><span class="p">;</span>
					<span class="c1">//multiply color with influence from gaussian function and add it to sum color</span>
					<span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
				<span class="cp">#endif
</span>				<span class="p">}</span>
				<span class="c1">//divide the sum of values by the amount of samples</span>
				<span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="n">sum</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">col</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">ENDCG</span>
		<span class="p">}</span>

		<span class="c1">//Horizontal Blur</span>
		<span class="n">Pass</span><span class="p">{</span>
			<span class="n">CGPROGRAM</span>
			<span class="c1">//include useful shader functions</span>
			<span class="cp">#include "UnityCG.cginc"
</span>
			<span class="cp">#pragma multi_compile _SAMPLES_LOW _SAMPLES_MEDIUM _SAMPLES_HIGH
</span>			<span class="cp">#pragma shader_feature GAUSS
</span>
			<span class="c1">//define vertex and fragment shader</span>
			<span class="cp">#pragma vertex vert
</span>			<span class="cp">#pragma fragment frag
</span>
			<span class="c1">//texture and transforms of the texture</span>
			<span class="kt">sampler2D</span> <span class="n">_MainTex</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">_BlurSize</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">_StandardDeviation</span><span class="p">;</span>

			<span class="cp">#define PI 3.14159265359
</span>			<span class="cp">#define E 2.71828182846
</span>
		<span class="cp">#if _SAMPLES_LOW
</span>			<span class="cp">#define SAMPLES 10
</span>		<span class="cp">#elif _SAMPLES_MEDIUM
</span>			<span class="cp">#define SAMPLES 30
</span>		<span class="cp">#else
</span>			<span class="cp">#define SAMPLES 100
</span>		<span class="cp">#endif
</span>
			<span class="c1">//the object data that's put into the vertex shader</span>
			<span class="k">struct</span> <span class="n">appdata</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the data that's used to generate fragments and can be read by the fragment shader</span>
			<span class="k">struct</span> <span class="n">v2f</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the vertex shader</span>
			<span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">){</span>
				<span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
				<span class="c1">//convert the vertex positions from object space to clip space so they can be rendered</span>
				<span class="n">o</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
				<span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">o</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="c1">//the fragment shader</span>
			<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
			<span class="cp">#if GAUSS
</span>				<span class="c1">//failsafe so we can use turn off the blur by setting the deviation to 0</span>
				<span class="k">if</span><span class="p">(</span><span class="n">_StandardDeviation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">);</span>
			<span class="cp">#endif
</span>				<span class="c1">//calculate aspect ratio</span>
				<span class="kt">float</span> <span class="n">invAspect</span> <span class="o">=</span> <span class="n">_ScreenParams</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">_ScreenParams</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
				<span class="c1">//init color variable</span>
				<span class="n">float4</span> <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cp">#if GAUSS
</span>				<span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cp">#else
</span>				<span class="kt">float</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">;</span>
			<span class="cp">#endif
</span>				<span class="c1">//iterate over blur samples</span>
				<span class="k">for</span><span class="p">(</span><span class="kt">float</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">SAMPLES</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">){</span>
					<span class="c1">//get the offset of the sample</span>
					<span class="kt">float</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="p">(</span><span class="n">SAMPLES</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">_BlurSize</span> <span class="o">*</span> <span class="n">invAspect</span><span class="p">;</span>
					<span class="c1">//get uv coordinate of sample</span>
					<span class="n">float2</span> <span class="n">uv</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">uv</span> <span class="o">+</span> <span class="n">float2</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="cp">#if !GAUSS
</span>					<span class="c1">//simply add the color if we don't have a gaussian blur (box)</span>
					<span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">);</span>
				<span class="cp">#else
</span>					<span class="c1">//calculate the result of the gaussian function</span>
					<span class="kt">float</span> <span class="n">stDevSquared</span> <span class="o">=</span> <span class="n">_StandardDeviation</span><span class="o">*</span><span class="n">_StandardDeviation</span><span class="p">;</span>
					<span class="kt">float</span> <span class="n">gauss</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">PI</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">))</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="o">-</span><span class="p">((</span><span class="n">offset</span><span class="o">*</span><span class="n">offset</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">stDevSquared</span><span class="p">)));</span>
					<span class="c1">//add result to sum</span>
					<span class="n">sum</span> <span class="o">+=</span> <span class="n">gauss</span><span class="p">;</span>
					<span class="c1">//multiply color with influence from gaussian function and add it to sum color</span>
					<span class="n">col</span> <span class="o">+=</span> <span class="n">tex2D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">uv</span><span class="p">)</span> <span class="o">*</span> <span class="n">gauss</span><span class="p">;</span>
				<span class="cp">#endif
</span>				<span class="p">}</span>
				<span class="c1">//divide the sum of values by the amount of samples</span>
				<span class="n">col</span> <span class="o">=</span> <span class="n">col</span> <span class="o">/</span> <span class="n">sum</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">col</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">ENDCG</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can also find the source here:</p>
<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/023_PostprocessingBlur/PostprocessingBlur.cs">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/023_PostprocessingBlur/PostprocessingBlur.cs</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/023_PostprocessingBlur/PostprocessingBlur.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/023_PostprocessingBlur/PostprocessingBlur.shader</a></li>
</ul>

<p>I hope I was able to show you another nice postprocessing effect which you can use to do many cool things.</p>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
