<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Perlin Noise</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="Perlin Noise One of other common form of noise is perlin noise. Perlin noise is one implementation of so called “gradient noise” similarly to value n..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Perlin Noise">
<meta itemprop="description" content="Perlin Noise One of other common form of noise is perlin noise. Perlin noise is one implementation of so called “gradient noise” similarly to value n...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/026/Result.gif">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Perlin Noise">
<meta name="twitter:description" content="Perlin Noise One of other common form of noise is perlin noise. Perlin noise is one implementation of so called “gradient noise” similarly to value n...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/026/Result.gif">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/026/Result.gif">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/09/15/perlin-noise.html">

<!-- Open Graph data -->
<meta property="og:title" content="Perlin Noise" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/09/15/perlin-noise.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/026/Result.gif" />

<meta property="og:description" content="Perlin Noise One of other common form of noise is perlin noise. Perlin noise is one implementation of so called “gradient noise” similarly to value n..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-09-15T00:00:00+02:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/09/15/perlin-noise.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">Perlin Noise</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-09-15T00:00:00+02:00" itemprop="datePublished">
          
          Sep 15, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Perlin Noise</h1>
    <p class="post-meta">
      <time datetime="2018-09-15T00:00:00+02:00" itemprop="datePublished">
        
        Sep 15, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#perlin-noise">Perlin Noise</a></li>
  <li><a href="#gradient-noise-in-one-dimension">Gradient Noise in one Dimension</a></li>
  <li><a href="#2d-perlin-noise">2d Perlin Noise</a></li>
  <li><a href="#3d-perlin-noise">3d Perlin Noise</a></li>
  <li><a href="#special-use-case">Special Use Case</a></li>
  <li><a href="#source">Source</a></li>
</ul>

  <div itemprop="articleBody">
    <h2 id="perlin-noise">Perlin Noise</h2>
<p>One of other common form of noise is perlin noise. Perlin noise is one implementation of so called “gradient noise” similarly to value noise it’s based on cells so it can be easily repeated and looks smooth. What differentiates it from value noise is that instead of interpolating the values, the values are based on inclinations. Because noise in general is a pretty complex topic I recommend you to read the tutorials on <a href="/2018/09/02/white-noise.html">white noise</a> and <a href="/2018/09/08/value-noise.html">value noise</a> first.</p>

<p><img src="/assets/images/posts/026/Result.gif" alt="" /></p>

<h2 id="gradient-noise-in-one-dimension">Gradient Noise in one Dimension</h2>
<p>Perlin noise is a specific implementation of gradient noise for multiple dimensions. But generating gradient noise in one dimension is also pretty simple, so we’ll start with that.</p>

<p>This first implementation will, just like in the previous noise tutorials, be just in one dimension. We start with the 1d value noise shader. First we move the code of the noise function in it’s own function for more readability.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">gradientNoise</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">previousCellNoise</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">nextCellNoise</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="kt">float</span> <span class="n">interpolator</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="n">interpolator</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">previousCellNoise</span><span class="p">,</span> <span class="n">nextCellNoise</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    
    <span class="kt">float</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">noise</span> <span class="o">-</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">pixelHeight</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">lineIntensity</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pixelHeight</span><span class="p">,</span> <span class="n">pixelHeight</span><span class="p">,</span> <span class="n">dist</span><span class="p">);</span>
    <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lineIntensity</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Like mentioned previously, perlin noise doesn’t interpolate the values, it interpolates between directions. That means we start by generating a random inclination. This inclination can both go up and down, so we multiply our random value by 2 to move it to the 0 to 2 range and then subtract 1 to move it between -1 and +1.</p>

<p>After generating the inclination we get the value of the line with the chosen generated inclination based on the fractional part of our value. Because the typical equation of a line is <code class="language-plaintext highlighter-rouge">base + inclination * variable</code> and when we use the fractional part as a variable the line originates at 0 so our line equation is simply <code class="language-plaintext highlighter-rouge">inclination * fractional part</code>.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">gradientNoise</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">previousCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">previousCellLinePoint</span> <span class="o">=</span> <span class="n">previousCellInclination</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="n">previousCellLinePoint</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/026/Inclinations.png" alt="" /></p>

<p>For proper smoothing, we have to generate the line for the next cell too. The line is then on the left of the cell center, so we have to use negative values approaching zero for our variable. To get those values, we simply subtract 1 from our fractional part. That way when we generate values on the left of the segment we start with 0 - 1 which equals -1 and approach 1 - 1 which equals 0. Similar to previous noise generation, we can get the random inclination of the next cell with <code class="language-plaintext highlighter-rouge">floor(value)+1</code> or <code class="language-plaintext highlighter-rouge">ceil(value)</code></p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">nextCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">nextCellLinePoint</span> <span class="o">=</span> <span class="n">nextCellInclination</span> <span class="o">*</span> <span class="p">(</span><span class="n">fraction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>The next step is similar to what we did for easing the interpolation, we want the value of the line of the previous cell at the beginning of the segment and the line of the next segment at the end. So we simply interpolate between those values based on where on the segment we are. We’ll still use the easing, just to make it look smoother.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">gradientNoise</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">interpolator</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">previousCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">previousCellLinePoint</span> <span class="o">=</span> <span class="n">previousCellInclination</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">nextCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">nextCellLinePoint</span> <span class="o">=</span> <span class="n">nextCellInclination</span> <span class="o">*</span> <span class="p">(</span><span class="n">fraction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">previousCellLinePoint</span><span class="p">,</span> <span class="n">nextCellLinePoint</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Another small thing I’d like to change before calling the 1d gradient noise done is that right now our <code class="language-plaintext highlighter-rouge">rand1dTo1d</code> function always returns exactly 0 when we input zero, because of the calculations we do in it. What I’ll do for now to fix that is to change the mutator variable from a multiplication to a simple addition with a unusual number, so we don’t have that abnormal looking value at the origin. (Those changes are in the Random.cginc library file)(for every one looking at this later, I might have already changed that in the white noise tutorial💖)</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">rand1dTo1d</span><span class="p">(</span><span class="n">float3</span> <span class="n">value</span><span class="p">,</span> <span class="kt">float</span> <span class="n">mutator</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">546</span><span class="p">){</span>
	<span class="kt">float</span> <span class="n">random</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="n">mutator</span><span class="p">)</span> <span class="o">*</span> <span class="mi">143758</span><span class="p">.</span><span class="mi">5453</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">random</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/1dGradient.png" alt="" /></p>

<h2 id="2d-perlin-noise">2d Perlin Noise</h2>

<p>For multidimensional perlin noise we can’t simply use a normal formula for a 1d line. Instead we interpolate the fraction in multiple dimensions and take the dot product with generated vectors of cells. To make the lines we generate with the dot product go to zero near the cell point itself, we scale the vector. That’s because of how the dot product works, a dot product with a <code class="language-plaintext highlighter-rouge">(0, 0)</code> vector will always be zero and a dot product with any vector and <code class="language-plaintext highlighter-rouge">(1, 0)</code> will always be twice as big as a dot product between <code class="language-plaintext highlighter-rouge">(0.5, 0)</code> and the same vector. Using the dot product this way means that we can use multiple dimensions as input well, but output will always be limited to one dimension.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">perlinNoise</span><span class="p">(</span><span class="n">float2</span> <span class="n">value</span><span class="p">){</span>
    <span class="kt">float</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">interpolator</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">previousCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">previousCellLinePoint</span> <span class="o">=</span> <span class="n">previousCellInclination</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">;</span>

    <span class="kt">float</span> <span class="n">nextCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">nextCellLinePoint</span> <span class="o">=</span> <span class="n">nextCellInclination</span> <span class="o">*</span> <span class="p">(</span><span class="n">fraction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">previousCellLinePoint</span><span class="p">,</span> <span class="n">nextCellLinePoint</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The first step of the implementation is generating 4 vectors in the 4 nearest cells, similarly to value noise. For that we can simply use the <code class="language-plaintext highlighter-rouge">rand2dTo2d</code> function we wrote in the white noise tutorial. Similarly to the 1d gradient noise, we want those vectors to point into all directions, not just to the top right in the 0 to 1 range like the random function returns. To fix that, we simply take the output of the random function, multiply it by 2 and subtract 1 again, the operations will automatically be applied to all components of the vector even though we only write down the scalar values.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float2</span> <span class="n">lowerLeftDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">float2</span> <span class="n">lowerRightDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">float2</span> <span class="n">upperLeftDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">float2</span> <span class="n">upperRightDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div>

<p>Then we generate the values again. They start at 0 at the cell, and then become bigger the further away they go.</p>

<p>For the lower left cell, which is equivalent to the previous cell in the 1d example, we can simply use the fraction as a vector as it is 0 at the cell and the y component becomes bigger the more we go up and the x component grows as we look further to the right, both increasing the absolute value of the result. On the lower right cell, we subtract <code class="language-plaintext highlighter-rouge">(1, 0)</code> from the value, so the vector will be smallest in the lower right corner and grow as we go left or up. Similarly to the 1d example we can also see here, that the value is negative when we approach the cell from the lower side, giving us continuous functions passing 0 at the cell position. And in the same matter we subtract <code class="language-plaintext highlighter-rouge">(0, 1)</code> from the fraction before taking the dot product with the upper left corner and subtract <code class="language-plaintext highlighter-rouge">(1, 1)</code> in case of the upper right corner.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float2</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

<span class="n">float2</span> <span class="n">lowerLeftFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">lowerLeftDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="n">float2</span> <span class="n">lowerRightFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">lowerRightDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="n">float2</span> <span class="n">upperLeftFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">upperLeftDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="n">float2</span> <span class="n">upperRightFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">upperRightDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</code></pre></div></div>

<p>Now that we generated all of our function values based on the random vectors we can interpolate between them like we’re used to. First the upper and lower pairs and then between the interpolated results.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">interpolatorX</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">interpolatorY</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">lowerCells</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">lowerLeftFunctionValue</span><span class="p">,</span> <span class="n">lowerRightFunctionValue</span><span class="p">,</span> <span class="n">interpolatorX</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">upperCells</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">upperLeftFunctionValue</span><span class="p">,</span> <span class="n">upperRightFunctionValue</span><span class="p">,</span> <span class="n">interpolatorX</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">lowerCells</span><span class="p">,</span> <span class="n">upperCells</span><span class="p">,</span> <span class="n">interpolatorY</span><span class="p">);</span>
<span class="k">return</span> <span class="n">noise</span><span class="p">;</span>
</code></pre></div></div>

<p>Now that we have the whole noise function, we can now display it. Because the function fluctuates around 0 and approximately goes up and down by about 0.5, we’ll add 0.5 to the result to get noise approximately from 0 to 1.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">float2</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">xz</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

    <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">noise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/2dPerlin.png" alt="" /></p>

<h2 id="3d-perlin-noise">3d Perlin Noise</h2>

<p>For 3d we’ll implement the readable version with nested loops again. It looks very similar to the 3d value noise shader we wrote, but instead of just writing the random values to the values to interpolate in the innermost loop, we generate a random direction based on the cell. Then we also generate the comparison vector by subtracting the same value we used to get the cell from the fractional vector. After we have both of those vectors, we simply take the dot product between the two vectors and assign it to the noise value we interpolate. The rest of the function looks just like the 3d value noise function we wrote earlier.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="nf">perlinNoise</span><span class="p">(</span><span class="n">float3</span> <span class="n">value</span><span class="p">){</span>
    <span class="n">float3</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">interpolatorX</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">interpolatorY</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">interpolatorZ</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

    <span class="n">float3</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">z</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">z</span><span class="o">++</span><span class="p">){</span>
        <span class="n">float3</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">y</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">y</span><span class="o">++</span><span class="p">){</span>
            <span class="n">float3</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">x</span><span class="o">++</span><span class="p">){</span>
                <span class="n">float3</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
                <span class="n">float3</span> <span class="n">cellDirection</span> <span class="o">=</span> <span class="n">rand3dTo3d</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">float3</span> <span class="n">compareVector</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
                <span class="n">cellNoiseX</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">cellDirection</span><span class="p">,</span> <span class="n">compareVector</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">cellNoiseY</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorX</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">cellNoiseZ</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorY</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">float3</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorZ</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">noise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For the input of the 3d noise, we now have to use 3d values as a input. With this 3d noise, we can then make coherent noise in 3d space without having to worry about generating 2d UVs or anything like that.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
    <span class="c1">//get noise and adjust it to be ~0-1 range</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

    <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">noise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/3dPerlin.png" alt="" /></p>

<h2 id="special-use-case">Special Use Case</h2>

<p>Perlin noise itself usually just looks like weird clouds, but we can do some interresting effects with it if we know what we want.</p>

<p>As a first interresting thing, we can visualize lines where the noise has the same height, similar to height lines on maps. To archieve that we multiply the noise to make the noise span a wider range. Then we take the fractional amount of that value and display it.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
<span class="c1">//get noise and adjust it to be ~0-1 range</span>
<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">noise</span> <span class="o">*</span> <span class="mi">6</span><span class="p">);</span>

<span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">noise</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/fracNoise.png" alt="" /></p>

<p>Then we can then make smooth lines from that. First we have to find out how how much the noise changes in one pixel distance, for that we simply use the fwidth function. Then we can make a smooth half line at the top of the fractional range, so near 1, by using the smoothstep function.</p>

<p>We give the smoothstep function 1 minus the amount the noise changes in the neighboring pixels as the first parameter, one as the second parameter and the noise itself as the third parameter. That way the function will return 0 for all values that are more than 1 pixel away, and interpolate to a value of 1 until it reaches 1, which is the maximum value after we appied the frac function. Similarly we do a smoothstep for the lower end of the range. We feed it the change of the noise to the neighboring pixels as a first parameter, 0 as a second one and simply the fraction of the noise as the third parameter. This function will then return 0 for all values over the noise pixel change and then interpolate to 1 towards 0. To get the whole line, we’ll simply add the two values and return them.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
    <span class="c1">//get noise and adjust it to be ~0-1 range</span>
    <span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

    <span class="n">noise</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">noise</span> <span class="o">*</span> <span class="mi">6</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">pixelNoiseChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">noise</span><span class="p">);</span>

    <span class="kt">float</span> <span class="n">heightLine</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pixelNoiseChange</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">noise</span><span class="p">);</span>
    <span class="n">heightLine</span> <span class="o">+=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">pixelNoiseChange</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">noise</span><span class="p">);</span>

    <span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">heightLine</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/heightLines.png" alt="" /></p>

<p>And a last nice trick is to use the 3d noise function in situations where you’d only need the 2d function. That allows you to factor the time into the 3rd dimension and animate the noise without scrolling. If you made a 4d implementation of perlin noise you could also animate the 4th dimension to get a similar effect in 3 dimensions.</p>

<p>For that we simply add the time variable to the component we don’t need before we pass it to the noise function.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Properties</span> <span class="p">{</span>
    <span class="n">_CellSize</span> <span class="p">(</span><span class="s">"Cell Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_ScrollSpeed</span> <span class="p">(</span><span class="s">"Scroll Speed"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//global variables</span>
<span class="kt">float</span> <span class="n">_CellSize</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">_ScrollSpeed</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
<span class="n">value</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_ScrollSpeed</span><span class="p">;</span>
<span class="c1">//get noise and adjust it to be ~0-1 range</span>
<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/026/AnimatedLines.gif" alt="" /></p>

<h2 id="source">Source</h2>

<p><strong>1d gradient noise</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/026_perlin_noise/1d"</span> <span class="p">{</span>
	<span class="n">Properties</span> <span class="p">{</span>
		<span class="n">_CellSize</span> <span class="p">(</span><span class="s">"Cell Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">}</span>
	<span class="n">SubShader</span> <span class="p">{</span>
		<span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

		<span class="n">CGPROGRAM</span>

		<span class="cp">#pragma surface surf Standard fullforwardshadows
</span>		<span class="cp">#pragma target 3.0
</span>
		<span class="cp">#include "Random.cginc"
</span>
		<span class="kt">float</span> <span class="n">_CellSize</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">worldPos</span><span class="p">;</span>
		<span class="p">};</span>

		<span class="kt">float</span> <span class="n">easeIn</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">easeIn</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeInOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="kt">float</span> <span class="n">easeInValue</span> <span class="o">=</span> <span class="n">easeIn</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">easeOutValue</span> <span class="o">=</span> <span class="n">easeOut</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">easeInValue</span><span class="p">,</span> <span class="n">easeOutValue</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">gradientNoise</span><span class="p">(</span><span class="kt">float</span> <span class="n">value</span><span class="p">){</span>
			<span class="kt">float</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolator</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">previousCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">previousCellLinePoint</span> <span class="o">=</span> <span class="n">previousCellInclination</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">;</span>

			<span class="kt">float</span> <span class="n">nextCellInclination</span> <span class="o">=</span> <span class="n">rand1dTo1d</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">nextCellLinePoint</span> <span class="o">=</span> <span class="n">nextCellInclination</span> <span class="o">*</span> <span class="p">(</span><span class="n">fraction</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

			<span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">previousCellLinePoint</span><span class="p">,</span> <span class="n">nextCellLinePoint</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
			<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">gradientNoise</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
			
			<span class="kt">float</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">noise</span> <span class="o">-</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">pixelHeight</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">lineIntensity</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pixelHeight</span><span class="p">,</span> <span class="n">pixelHeight</span><span class="p">,</span> <span class="n">dist</span><span class="p">);</span>
			<span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lineIntensity</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">ENDCG</span>
	<span class="p">}</span>
	<span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>2d perlin noise</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/026_perlin_noise/2d"</span> <span class="p">{</span>
	<span class="n">Properties</span> <span class="p">{</span>
		<span class="n">_CellSize</span> <span class="p">(</span><span class="s">"Cell Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">}</span>
	<span class="n">SubShader</span> <span class="p">{</span>
		<span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

		<span class="n">CGPROGRAM</span>

		<span class="cp">#pragma surface surf Standard fullforwardshadows
</span>		<span class="cp">#pragma target 3.0
</span>
		<span class="cp">#include "Random.cginc"
</span>
		<span class="kt">float</span> <span class="n">_CellSize</span><span class="p">;</span>
		<span class="kt">float</span> <span class="n">_Jitter</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">worldPos</span><span class="p">;</span>
		<span class="p">};</span>

		<span class="kt">float</span> <span class="n">easeIn</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">easeIn</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeInOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="kt">float</span> <span class="n">easeInValue</span> <span class="o">=</span> <span class="n">easeIn</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">easeOutValue</span> <span class="o">=</span> <span class="n">easeOut</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">easeInValue</span><span class="p">,</span> <span class="n">easeOutValue</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">float2</span> <span class="n">value</span><span class="p">){</span>
			<span class="c1">//generate random directions</span>
			<span class="n">float2</span> <span class="n">lowerLeftDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">float2</span> <span class="n">lowerRightDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">float2</span> <span class="n">upperLeftDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">float2</span> <span class="n">upperRightDirection</span> <span class="o">=</span> <span class="n">rand2dTo2d</span><span class="p">(</span><span class="n">float2</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="n">ceil</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">y</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

			<span class="n">float2</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

			<span class="c1">//get values of cells based on fraction and cell directions</span>
			<span class="kt">float</span> <span class="n">lowerLeftFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">lowerLeftDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">lowerRightFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">lowerRightDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">upperLeftFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">upperLeftDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
			<span class="kt">float</span> <span class="n">upperRightFunctionValue</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">upperRightDirection</span><span class="p">,</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>

			<span class="kt">float</span> <span class="n">interpolatorX</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolatorY</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

			<span class="c1">//interpolate between values</span>
			<span class="kt">float</span> <span class="n">lowerCells</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">lowerLeftFunctionValue</span><span class="p">,</span> <span class="n">lowerRightFunctionValue</span><span class="p">,</span> <span class="n">interpolatorX</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">upperCells</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">upperLeftFunctionValue</span><span class="p">,</span> <span class="n">upperRightFunctionValue</span><span class="p">,</span> <span class="n">interpolatorX</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">lowerCells</span><span class="p">,</span> <span class="n">upperCells</span><span class="p">,</span> <span class="n">interpolatorY</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">noise</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">float2</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span><span class="p">.</span><span class="n">xz</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
			<span class="c1">//get noise and adjust it to be ~0-1 range</span>
			<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

			<span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">noise</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ENDCG</span>
	<span class="p">}</span>
	<span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>3d perlin noise</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/026_perlin_noise/3d"</span> <span class="p">{</span>
	<span class="n">Properties</span> <span class="p">{</span>
		<span class="n">_CellSize</span> <span class="p">(</span><span class="s">"Cell Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">}</span>
	<span class="n">SubShader</span> <span class="p">{</span>
		<span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

		<span class="n">CGPROGRAM</span>

		<span class="cp">#pragma surface surf Standard fullforwardshadows
</span>		<span class="cp">#pragma target 3.0
</span>
		<span class="cp">#include "Random.cginc"
</span>
		<span class="kt">float</span> <span class="n">_CellSize</span><span class="p">;</span>
		<span class="kt">float</span> <span class="n">_Jitter</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">worldPos</span><span class="p">;</span>
		<span class="p">};</span>

		<span class="kt">float</span> <span class="n">easeIn</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">easeIn</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeInOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="kt">float</span> <span class="n">easeInValue</span> <span class="o">=</span> <span class="n">easeIn</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">easeOutValue</span> <span class="o">=</span> <span class="n">easeOut</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">easeInValue</span><span class="p">,</span> <span class="n">easeOutValue</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">float3</span> <span class="n">value</span><span class="p">){</span>
			<span class="n">float3</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">interpolatorX</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolatorY</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolatorZ</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

			<span class="n">float3</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
			<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">z</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">z</span><span class="o">++</span><span class="p">){</span>
				<span class="n">float3</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
				<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">y</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">y</span><span class="o">++</span><span class="p">){</span>
					<span class="n">float3</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
					<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
					<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">x</span><span class="o">++</span><span class="p">){</span>
						<span class="n">float3</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
						<span class="n">float3</span> <span class="n">cellDirection</span> <span class="o">=</span> <span class="n">rand3dTo3d</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
						<span class="n">float3</span> <span class="n">compareVector</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
						<span class="n">cellNoiseX</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">cellDirection</span><span class="p">,</span> <span class="n">compareVector</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">cellNoiseY</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorX</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">cellNoiseZ</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorY</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">float3</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorZ</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">noise</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
			<span class="c1">//get noise and adjust it to be ~0-1 range</span>
			<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

			<span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">noise</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ENDCG</span>
	<span class="p">}</span>
	<span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>special use tricks</strong></p>
<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/026_perlin_noise/special"</span> <span class="p">{</span>
	<span class="n">Properties</span> <span class="p">{</span>
		<span class="n">_CellSize</span> <span class="p">(</span><span class="s">"Cell Size"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">_ScrollSpeed</span> <span class="p">(</span><span class="s">"Scroll Speed"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">}</span>
	<span class="n">SubShader</span> <span class="p">{</span>
		<span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

		<span class="n">CGPROGRAM</span>

		<span class="cp">#pragma surface surf Standard fullforwardshadows
</span>		<span class="cp">#pragma target 3.0
</span>
		<span class="cp">#include "Random.cginc"
</span>
		<span class="kt">float</span> <span class="n">_CellSize</span><span class="p">;</span>
		<span class="kt">float</span> <span class="n">_ScrollSpeed</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">Input</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">worldPos</span><span class="p">;</span>
		<span class="p">};</span>

		<span class="kt">float</span> <span class="n">easeIn</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="n">interpolator</span> <span class="o">*</span> <span class="n">interpolator</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">easeIn</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">easeInOut</span><span class="p">(</span><span class="kt">float</span> <span class="n">interpolator</span><span class="p">){</span>
			<span class="kt">float</span> <span class="n">easeInValue</span> <span class="o">=</span> <span class="n">easeIn</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">easeOutValue</span> <span class="o">=</span> <span class="n">easeOut</span><span class="p">(</span><span class="n">interpolator</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">lerp</span><span class="p">(</span><span class="n">easeInValue</span><span class="p">,</span> <span class="n">easeOutValue</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kt">float</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">float3</span> <span class="n">value</span><span class="p">){</span>
			<span class="n">float3</span> <span class="n">fraction</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">interpolatorX</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolatorY</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
			<span class="kt">float</span> <span class="n">interpolatorZ</span> <span class="o">=</span> <span class="n">easeInOut</span><span class="p">(</span><span class="n">fraction</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>

			<span class="n">float3</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
			<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">z</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">z</span><span class="o">++</span><span class="p">){</span>
				<span class="n">float3</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
				<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">y</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">y</span><span class="o">++</span><span class="p">){</span>
					<span class="n">float3</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
					<span class="p">[</span><span class="n">unroll</span><span class="p">]</span>
					<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">x</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">x</span><span class="o">++</span><span class="p">){</span>
						<span class="n">float3</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
						<span class="n">float3</span> <span class="n">cellDirection</span> <span class="o">=</span> <span class="n">rand3dTo3d</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
						<span class="n">float3</span> <span class="n">compareVector</span> <span class="o">=</span> <span class="n">fraction</span> <span class="o">-</span> <span class="n">float3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
						<span class="n">cellNoiseX</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">cellDirection</span><span class="p">,</span> <span class="n">compareVector</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="n">cellNoiseY</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseX</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorX</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">cellNoiseZ</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorY</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">float3</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">lerp</span><span class="p">(</span><span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cellNoiseZ</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolatorZ</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">noise</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kt">void</span> <span class="n">surf</span> <span class="p">(</span><span class="n">Input</span> <span class="n">i</span><span class="p">,</span> <span class="k">inout</span> <span class="n">SurfaceOutputStandard</span> <span class="n">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">float3</span> <span class="n">value</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">worldPos</span> <span class="o">/</span> <span class="n">_CellSize</span><span class="p">;</span>
			<span class="n">value</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">_Time</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">_ScrollSpeed</span><span class="p">;</span>
			<span class="c1">//get noise and adjust it to be ~0-1 range</span>
			<span class="kt">float</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">perlinNoise</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

			<span class="n">noise</span> <span class="o">=</span> <span class="n">frac</span><span class="p">(</span><span class="n">noise</span> <span class="o">*</span> <span class="mi">6</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">pixelNoiseChange</span> <span class="o">=</span> <span class="n">fwidth</span><span class="p">(</span><span class="n">noise</span><span class="p">);</span>

			<span class="kt">float</span> <span class="n">heightLine</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pixelNoiseChange</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">noise</span><span class="p">);</span>
			<span class="n">heightLine</span> <span class="o">+=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">pixelNoiseChange</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">noise</span><span class="p">);</span>

			<span class="n">o</span><span class="p">.</span><span class="n">Albedo</span> <span class="o">=</span> <span class="n">heightLine</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ENDCG</span>
	<span class="p">}</span>
	<span class="n">FallBack</span> <span class="s">"Standard"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It took me a long time to understand how perlin noise works and I hope that by putting it into words here I made it easier for you, and that you’ll be able to create amazing effects with it.</p>

<p>You can also find the sources to the shaders of this tutorial here:</p>
<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_1d.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_1d.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_2d.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_2d.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_3d.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_3d.shader</a></li>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_special.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/026_Perlin_Noise/perlin_noise_special.shader</a></li>
</ul>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
