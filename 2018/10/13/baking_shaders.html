<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Non social metatags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#157878">

    

    <title>Baking Shaders into Textures</title>

    
      <!-- Update your html tag to include the itemscope and itemtype attributes. -->
<html itemscope itemtype="http://schema.org/Article">












<!-- Place this data between the <head> tags of your website -->

  <meta name="author" content="Ronja Böhringer">

<meta name="description" content="Calculating everything ony the fly in the shader gives us the most flexibility and is even needed for many effects, but if we don’t need the noise to..." />





<!-- Schema.org markup for Google+ -->
<meta itemprop="name" content="Baking Shaders into Textures">
<meta itemprop="description" content="Calculating everything ony the fly in the shader gives us the most flexibility and is even needed for many effects, but if we don’t need the noise to...">

  <meta itemprop="image" content="https://www.ronja-tutorials.com/assets/images/posts/030/MagicEditor.png">


<!-- Twitter Card data -->
<meta name="twitter:card" content="summary_large_image">



<meta name="twitter:title" content="Baking Shaders into Textures">
<meta name="twitter:description" content="Calculating everything ony the fly in the shader gives us the most flexibility and is even needed for many effects, but if we don’t need the noise to...">


  <meta name="twitter:creator" content="@TotallyRonja">


<!-- Twitter summary card with large image must be at least 280x150px -->

  <meta name="twitter:image:src" content="https://www.ronja-tutorials.com/assets/images/posts/030/MagicEditor.png">
  <meta property="twitter:image" content="https://www.ronja-tutorials.com/assets/images/posts/030/MagicEditor.png">

<meta property="twitter:url" content="https://www.ronja-tutorials.com/2018/10/13/baking_shaders.html">

<!-- Open Graph data -->
<meta property="og:title" content="Baking Shaders into Textures" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.ronja-tutorials.com/2018/10/13/baking_shaders.html" />

  <meta property="og:image" content="https://www.ronja-tutorials.com/assets/images/posts/030/MagicEditor.png" />

<meta property="og:description" content="Calculating everything ony the fly in the shader gives us the most flexibility and is even needed for many effects, but if we don’t need the noise to..." />
<meta property="og:site_name" content="Ronja's Shader Tutorials" />

  <meta property="article:published_time" content="2018-10-13T00:00:00+02:00" />














  





  




    

    <link rel="canonical" href="https://www.ronja-tutorials.com/2018/10/13/baking_shaders.html">

    

    <!-- <link rel="shortcut icon" href="https://www.ronja-tutorials.com/favicon.ico"> -->
    <meta name="robots" content="noarchive">

    <!-- <link rel="alternate" media="only screen and (max-width: 640px)" href="">
    <link rel="alternate" media="handheld" href=""> -->


    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <script async defer data-website-id="fb34d410-ef67-4a3a-8fdc-01a05f5e22b2" src="https://stats.ruby0x1.ca/umami.js" ></script>
    <link rel="stylesheet" href="/assets/css/style.css?v=">
  </head>
  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    

    
      <a class="site-title" href="/">Ronja&#39;s Shader Tutorials</a>
    
    <!-- SVG icons from https://iconmonstr.com -->

    <!-- Twitter icon -->
    <span class="my-span-icon">
        <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
          <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
        </a>
      </span>

      <!-- RSS icon -->
      
        <span class="my-span-icon">
          <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
          </a>
        </span>
      
      <!-- Contact icon -->
      
      
        <span class="my-span-icon">
          <a href="/about.html" aria-label="Contact" title="Contact ">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
          </a>
        </span>
      

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
              
            
          
            
            
          
            
            
              
                <a class="page-link" href="/about.html">About</a>
              
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
              
                <a class="page-link" href="/2018/03/20/hlsl-basics.html"></a>
              
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    
    
    

    <section class="page-header">
      <h1 class="project-name">Baking Shaders into Textures</h1>
      <h2 class="project-tagline"></h2>
      
      <!-- Post tagline -->
      
        <h2 class="project-date">
        <time datetime="2018-10-13T00:00:00+02:00" itemprop="datePublished">
          
          Oct 13, 2018
        </time>
        
        
          • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Ronja Böhringer</span></span>
        
        </h2>
      
      <!-- End: Post tagline -->
    </section>

    <section class="main-content">

      <article itemscope itemtype="http://schema.org/BlogPosting">

  <!-- <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Baking Shaders into Textures</h1>
    <p class="post-meta">
      <time datetime="2018-10-13T00:00:00+02:00" itemprop="datePublished">
        
        Oct 13, 2018
      </time>
      </p>
  </header> -->

  
<ul>
  <li><a href="#simple-editor">Simple Editor</a></li>
  <li><a href="#2d-texture-baking">2D Texture Baking</a></li>
  <li><a href="#better-editor">Better Editor</a></li>
  <li><a href="#3d-texture-baking">3D Texture Baking</a></li>
  <li><a href="#use-3d-textures">Use 3d textures</a></li>
  <li><a href="#source">Source</a>
    <ul>
      <li><a href="#bake-texture-window">Bake Texture Window</a></li>
      <li><a href="#bake-texture3d-window">Bake Texture3d Window</a></li>
      <li><a href="#read-from-3d-texture">Read from 3d Texture</a></li>
    </ul>
  </li>
</ul>

  <div itemprop="articleBody">
    <p>Calculating everything ony the fly in the shader gives us the most flexibility and is even needed for many effects, but if we don’t need the noise to be dynamic we can save it to a texture to save a lot of performance in the shader. You can bake all shader output into textures as long as it doesn’t depend on external parameters like object position or lighting.</p>

<p>We’re going to make a little editor tool in this tutorial that can be used to bake any shader output into a texture, but I’ll work with noise functions for now, because they can be kinda expensive and are easily repeatable which allows us to use smaller textures. If you want to understand and also use noise functions, I have my tutorials about noise listed here: <a href="/noise.html">ronja-tutorials.com/noise.html</a>.</p>

<p><img src="/assets/images/posts/030/MagicEditor.png" alt="" /></p>

<h2 id="simple-editor">Simple Editor</h2>

<p>For the editor we’re going to make our own unity editor window. Editor windows are tabs similar to the scene or inspector tab. You’ll be able to dock it anywhere or move it as it’s own window. To create the window we create a new C# script. We’ll put it in a folder called “Editor” or a subfolder of a editor folder. That way the script will not be included if we export our game, but will allow us to access some functions that are only for the unity editor and not games.</p>

<p>First we let the script inherit from the <code class="language-plaintext highlighter-rouge">EditorWindow</code> class, that will allow us to expand it to make our own window. To have access to that class, we’ll import the <code class="language-plaintext highlighter-rouge">UnityEditor</code> namespace. Then we add a a function to open a new window. We’ll mark it with the <code class="language-plaintext highlighter-rouge">static</code> keyword, that way it can be called even when no window is open currently. In the function we’ll call <code class="language-plaintext highlighter-rouge">EditorWindow.GetWindow</code>. It’s a function that will create a new window if none exists or returns a old one if we created one earlier. We’ll have to specify what kind of window we want to create though. This is a generic function, so we can put the type in angle brackets between the function name and the round brackets we use for the arguments. This then looks like this: <code class="language-plaintext highlighter-rouge">EditorWindow.GetWindow&lt;YourWindowClass&gt;()</code>. We then save the return value of the GetWindow function in a variable and call the <code class="language-plaintext highlighter-rouge">Show</code> method so show the window to the user. To be able to open the window in the Editor, we’ll simply add the <code class="language-plaintext highlighter-rouge">MenuItem</code> attribute to the function, it will add a item to the menu at the top of the menu which will call this function when we click it, it takes the name of the item as a parameter, slashes allow us to put the item in directories.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BakeTextureWindow</span> <span class="p">:</span> <span class="n">EditorWindow</span> <span class="p">{</span>
    <span class="p">[</span><span class="nf">MenuItem</span> <span class="p">(</span><span class="s">"Tools/Bake material to texture"</span><span class="p">)]</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//create window</span>
        <span class="n">BakeTextureWindow</span> <span class="n">window</span> <span class="p">=</span> <span class="n">EditorWindow</span><span class="p">.</span><span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">BakeTextureWindow</span><span class="p">&gt;();</span>
        <span class="n">window</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="/assets/images/posts/030/MenuItem.png" alt="" /></p>

<p><img src="/assets/images/posts/030/EmptyEditor.png" alt="" /></p>

<p>As you can see the editor is completely empty so far, so the next step is to add variables to edit. We want to know which material we want to bake into a texture, how big the texture is and what file we want to save the texture to. We add those variables at the top of our class. The material to bake is a normal material, the image size can be summarized as a 2 dimensional integer vector and the file path is a normal string. We’ll also have to declare that we’re using the <code class="language-plaintext highlighter-rouge">UnityEngine</code> namespace to have access to the material and vector classes.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Material</span> <span class="n">ImageMaterial</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">FilePath</span> <span class="p">=</span> <span class="s">"Assets/MaterialImage.png"</span><span class="p">;</span>
<span class="n">Vector2Int</span> <span class="n">Resolution</span><span class="p">;</span>
</code></pre></div></div>

<p>This doesn’t show the variables to the user though. To display them we have to write our own user interface. To do that we simply create a function called <code class="language-plaintext highlighter-rouge">OnGUI</code>. It will be called automatically by unity whenever the GUI refreshes. The field for the material basically holds a reference to the material object in our files, so we use <code class="language-plaintext highlighter-rouge">EditorGUILayout.ObjectField</code>. The first parameter of the ObjectField function is the name we want to display for the field, the second is the value the material has right now, the third is the type of the object (in our case it’s a material) and the third parameter is wether we allow users to add objects from the scene to the field, because materials can’t exist on their own in the scene we’ll just deny that. The ObjectField function will then return the new value as a Object, so to put the new value into our material variable we’ll have to cast it to a material.</p>

<p>The second parameter is our resolution. Luckily there is the <code class="language-plaintext highlighter-rouge">EditorGUILayout.Vector2IntField</code> function, so we can just pass the display name of the variable as the first parameter and the current value as the second. We then directly apply the return value to the resolution again. Similarly for the file path, we’ll use a <code class="language-plaintext highlighter-rouge">EditorGUILayout.TextField</code> for now with the display name and the current value as arguments just like previously.</p>

<p>Now we can already enter all of the values we need to bake a texture, but we can’t trigger the texture baking yet. To trigger the baking, we’ll add a button. We add buttons in GUI by calling <code class="language-plaintext highlighter-rouge">GUILayout.Button</code>. We can give it a string as a argument and it’ll use it as a label. The function then returns a boolean which is true in the one frame that a user clicks it, so we can directly use the function as the value for a if condition.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">OnGUI</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ImageMaterial</span> <span class="p">=</span> <span class="p">(</span><span class="n">Material</span><span class="p">)</span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">ObjectField</span><span class="p">(</span><span class="s">"Material"</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Material</span><span class="p">),</span> <span class="k">false</span><span class="p">);</span>
    <span class="n">Resolution</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">Vector2IntField</span><span class="p">(</span><span class="s">"Image Resolution"</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">);</span>
    <span class="n">FilePath</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">TextField</span><span class="p">(</span><span class="s">"Image Path"</span><span class="p">,</span> <span class="n">FilePath</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
        <span class="c1">//bake texture</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/030/VariablesEditor.png" alt="" /></p>

<h2 id="2d-texture-baking">2D Texture Baking</h2>

<p>Now that we have a editor, we can implement the baking logic. For easier code management, we’ll write the baking logic into it’s own function which we’ll call when the bake button is pressed.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
    <span class="nf">BakeTexture</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">BakeTexture</span><span class="p">(){</span>
    <span class="c1">// Bake texture</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Similarly as in postprocessing, we’ll deal with images via rendertextures here. Because we only need the rendertexture for a short time, we can use a temporary rendertexture which is more convenient and faster than creating a new one. We get the rendertexture by calling <code class="language-plaintext highlighter-rouge">RenderTexture.GetTemporary</code> and pass the resolution x and y components as the width and height of the rendertexture. After fetching the rendertexture we can then write to it with <code class="language-plaintext highlighter-rouge">Graphics.Blit</code>. The blit function expects us to give it a input as well as a output texture, but because we’ll take all of our data directly from our material we pass <code class="language-plaintext highlighter-rouge">null</code> as the first parameter. The second parameter is the output texture, so we pass it the new rendertexture we just got. The last parameter is the material we use, so that’s the material we set in the inspector.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//render material to rendertexture</span>
<span class="n">RenderTexture</span> <span class="n">renderTexture</span> <span class="p">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">GetTemporary</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">renderTexture</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">);</span>
</code></pre></div></div>

<p>Now, that we have the output of the shader, the next step is to save it to a texture2d to be able to save it. First we create a new texture2d with the size of the resolution. Then we set the rendertexture with our shader output as the active rendertexture, that way it is written to the texture when we call <code class="language-plaintext highlighter-rouge">ReadPixels</code> on the texture variable. The <code class="language-plaintext highlighter-rouge">ReadPixels</code> function wants to know which area of the rendertexture we want to copy, so to copy the whole area, we give it a rectangle that starts in the <code class="language-plaintext highlighter-rouge">(0, 0)</code> corner and has the size of the whole resolution. As the position of where to insert the texture, we also tell it to start in the <code class="language-plaintext highlighter-rouge">(0, 0)</code> corner. This way the function will copy the whole rendertexture to the texture.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//transfer image from rendertexture to texture</span>
<span class="n">Texture2D</span> <span class="n">texture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture2D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="n">renderTexture</span><span class="p">;</span>
<span class="n">texture</span><span class="p">.</span><span class="nf">ReadPixels</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
</code></pre></div></div>

<p>Now we have the image in a texture we can save it as a png. First we encode into png and save the bytes. Then we write the bytes to the path we declared. As a last step we tell unity to refresh it’s asset database, this way we make sure it will find the new file and show it to us in the editor. Writing the bytes to a file means we’ll have to declare that we’re using the <code class="language-plaintext highlighter-rouge">System.IO</code> namespace, where most C# file input and output classes are located.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//save texture to file</span>
<span class="kt">byte</span><span class="p">[]</span> <span class="n">png</span> <span class="p">=</span> <span class="n">texture</span><span class="p">.</span><span class="nf">EncodeToPNG</span><span class="p">();</span>
<span class="n">File</span><span class="p">.</span><span class="nf">WriteAllBytes</span><span class="p">(</span><span class="n">ImageFile</span><span class="p">,</span> <span class="n">png</span><span class="p">);</span>
<span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">Refresh</span><span class="p">();</span>
</code></pre></div></div>

<p>At the end of the function we should clean up our variables. We release the rendertexture to be reused by other functions. We’ll also set the active rendertexture to null, this shouldn’t be nessecary, but it can avoid unexpected behaviour, so we do it just in case. And then we also destroy the texture so it doesn’t take up any ram anymore, we have it saved on the harddrive now so we don’t need it here anymore. We use DestroyImmediate here because we’re running the script while the game is not running and Destroy only works when the game is running.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//clean up variables</span>
<span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="n">RenderTexture</span><span class="p">.</span><span class="nf">ReleaseTemporary</span><span class="p">(</span><span class="n">renderTexture</span><span class="p">);</span>
<span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
</code></pre></div></div>

<p>And with this function we have everything we need to bake the output of a shader to a texture. We can then use those textures just like we use all other textures.</p>

<p><img src="/assets/images/posts/030/SimpleEditorFilled.png" alt="" /></p>

<p><img src="/assets/images/posts/030/BakedPerlin.png" alt="" /></p>

<h2 id="better-editor">Better Editor</h2>

<p>Our editor is functional, but it breaks easily if you enter the wrong input, could be better explained and especially entering the path is unnessecarily compicated, so let’s improve that.</p>

<p>First we’re going to add a function that checks what variables are entered. We’ll declare boolean variables in the class so we can access which inputs are valid from everywhere. The material counts as entered when it’s not null, the resolution counts as valid if both components are above 0 and the file path counts as entered if it points to a png file. The first two are pretty easily checked, for the last one we’ll use the utility of the <code class="language-plaintext highlighter-rouge">Path</code> class. <code class="language-plaintext highlighter-rouge">Path.GetExtension</code> returns the extension of a path, so we can easily check if that extension is <code class="language-plaintext highlighter-rouge">.png</code>. But if we give the GetExtension function a invalid path it’ll throw a exception which can crash our script. To avoid the exception crashing our script we first set the boolean which saves wether we have a valid file path to false and then check the extension in a try/catch block. That way if the function returns a exception it will just not touch the variable and it’ll stay false, which is the value we want it to have for invalid paths. To be able to access the ArgumentException which is the exception type GetExtension can throw we’ll also have to declare that we’re using the System namespace.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">bool</span> <span class="n">hasMaterial</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">hasResolution</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">hasImageFile</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">CheckInput</span><span class="p">(){</span>
    <span class="c1">//check which values are entered already</span>
    <span class="n">hasMaterial</span> <span class="p">=</span> <span class="n">ImageMaterial</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
    <span class="n">hasResolution</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">;</span>
    <span class="n">hasImageFile</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="kt">string</span> <span class="n">ext</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetExtension</span><span class="p">(</span><span class="n">ImageFile</span><span class="p">);</span>
        <span class="n">hasImageFile</span> <span class="p">=</span> <span class="n">ext</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">".png"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now that we have this function, we should call it to update the variables in 2 situations. When we open a new window and when one of the variables changes. The first one is pretty easy, we just call it on the new window in our static function where we create a new window.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">MenuItem</span> <span class="p">(</span><span class="s">"Tools/Bake material to texture"</span><span class="p">)]</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//create window</span>
    <span class="n">BakeTextureWindow</span> <span class="n">window</span> <span class="p">=</span> <span class="n">EditorWindow</span><span class="p">.</span><span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">BakeTextureWindow</span><span class="p">&gt;();</span>
    <span class="n">window</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>

    <span class="n">window</span><span class="p">.</span><span class="nf">CheckInput</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For the other situation we have to create a change check scope around the variable fields. We can do that either by using <code class="language-plaintext highlighter-rouge">EditorGUI.BeginChangeCheck</code> and <code class="language-plaintext highlighter-rouge">EditorGUI.EndChangeCheck</code> or we can use a <code class="language-plaintext highlighter-rouge">ChangeCheckScope</code> inside of a using block. I personally prefer the second solution, so we’ll do that. We write a using block around the variable fields, saving a new <code class="language-plaintext highlighter-rouge">ChangeCheckScope</code> at it’s beginning. Then, after the fields are drawn, we can access it’s <code class="language-plaintext highlighter-rouge">changed</code> property to see wether one of the variables was edited. If it was, we call <code class="language-plaintext highlighter-rouge">CheckInput</code>.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">OnGUI</span><span class="p">(){</span>
    <span class="k">using</span><span class="p">(</span><span class="kt">var</span> <span class="n">check</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EditorGUI</span><span class="p">.</span><span class="nf">ChangeCheckScope</span><span class="p">()){</span>
        <span class="n">ImageMaterial</span> <span class="p">=</span> <span class="p">(</span><span class="n">Material</span><span class="p">)</span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">ObjectField</span><span class="p">(</span><span class="s">"Material"</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Material</span><span class="p">),</span> <span class="k">false</span><span class="p">);</span>
        <span class="n">Resolution</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">Vector2IntField</span><span class="p">(</span><span class="s">"Image Resolution"</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">);</span>
        <span class="n">FilePath</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">TextField</span><span class="p">(</span><span class="s">"Image Path"</span><span class="p">,</span> <span class="n">FilePath</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">changed</span><span class="p">){</span>
            <span class="nf">CheckInput</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
        <span class="nf">BakeTexture</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we always know which input is valid and can work with that information. The first thing we do is to only enable the bake button if all inputs are valid. We toggle wether the button is interactable or not by setting <code class="language-plaintext highlighter-rouge">GUI.enabled</code> before drawing it. After we’ve drawn the button we’ll set <code class="language-plaintext highlighter-rouge">GUI.enabled</code> back to true so we don’t mess with other interfaces.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="n">hasMaterial</span> <span class="p">&amp;&amp;</span> <span class="n">hasResolution</span> <span class="p">&amp;&amp;</span> <span class="n">hasFilePath</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
    <span class="nf">BakeTexture</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</code></pre></div></div>

<p>Then we can also show warnings to the user if specific inputs are not set yet, so they know what’s missing. I’ll use the <code class="language-plaintext highlighter-rouge">EditorGUILayout.HelpBox</code> function for this feedback, but there are also other ways, like labels that are less intrusive. We can also set how the helpbox should look like. I use the <code class="language-plaintext highlighter-rouge">MessagyType.Warning</code> version so we get a obvious yellow triangle showing the user that something is missing.</p>

<p>Put the code for the help boxes where you want to see them in the UI, I put mine at the very bottom under the bake button.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//tell the user what inputs are missing</span>
<span class="k">if</span><span class="p">(!</span><span class="n">hasMaterial</span><span class="p">){</span>
    <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"You're still missing a material to bake."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(!</span><span class="n">hasResolution</span><span class="p">){</span>
    <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Please set a size bigger than zero."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(!</span><span class="n">hasFilePath</span><span class="p">){</span>
    <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"No file to save the image to given."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Similarly I put a helpbox at the top of the <code class="language-plaintext highlighter-rouge">OnGUI</code> function to roughly explain how the interface works.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Set the material you want to bake as well as the size "</span><span class="p">+</span>
        <span class="s">"and location of the texture you want to bake to, then press the \"Bake\" button."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>
</code></pre></div></div>

<p>For the last improvement to the editor we’re going to improve how choosing the file path works. For this we’ll add another method for drawing a textfield with a choose file button. This new function will take the current value of the path as a argument and will return the new path value. We’ll start our custom field by displaying a labelfield with the display name of the path. A labelfield will simply display the text you pass it, not allowing the user to edit anything. I give the labelfield it’s own line by doing this, and put the rest of the path field another line because the path can get pretty long.</p>

<p>Then we’ll start a horizontal scope. This will change the gui so everything in this scope will be drawn next to each other from left to right instead of under each other. Just like the changecheck field we can either use <code class="language-plaintext highlighter-rouge">BeginHorizontal</code> and <code class="language-plaintext highlighter-rouge">EndHorizontal</code> in <code class="language-plaintext highlighter-rouge">EditorGUILayout</code> or we can use a <code class="language-plaintext highlighter-rouge">HorizontalScope</code>. I’ll also use the second solution here, but you’re free to do whatever feels right to you.</p>

<p>Inside the horizonal scope, we’ll display two fields, one the textfield we already used previously, but this time we’ll only pass it one parameter, this way it just displays a text, without a name in front of it. Second, we display a button to choose a file.</p>

<p>If we press the button we first need to find out the current directory and file name of the path, but similarly to where we’re checking the extension we have to expect having a invalid path. So we set a directory and a file name of our choice as default values and then try to overwrite them with the correct values from the path we get from <code class="language-plaintext highlighter-rouge">Path.GetDirectoryName</code> and <code class="language-plaintext highlighter-rouge">Path.GetFileName</code>. If they fail, they’ll throw a <code class="language-plaintext highlighter-rouge">ArgumentException</code> which we’ll catch and then completely ignore because we know the default values are still in the variables so we can use them. After we have those values, we can call <code class="language-plaintext highlighter-rouge">EditorUtility.SaveFilePanelInProject</code> to find a place for our image file. The first argument of the function is the panel header, the second is the file name where to start, the third is the file extension, the fourth is a more detailed description of what we want to file for, as far as I’ve seen it’s not visible when opening the dialogue in windows, but I think it’s visible on macOS systems? And the final argument we’ll use is the directory where to put the file. We will save the output of this panel in a new string because if we close the panel instead of pressing save, it will return a empty string. Then we check if the string is empty and if isn’t we then apply the new path to our path variable. After chosing the path, we’ll also manually trigger a redraw of the whole window to update the textfield which doesn’t know theres a new value for the image path yet.</p>

<p>At the end of this custom field function we’ll simply return the new path. With this new function we can replace the textfield as a means to get the file path and now have a easier way of choosing a file to write to.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span> <span class="nf">FileField</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">){</span>
    <span class="c1">//allow the user to enter output file both as text or via file browser</span>
    <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">LabelField</span><span class="p">(</span><span class="s">"Output file"</span><span class="p">);</span>
    <span class="k">using</span><span class="p">(</span><span class="k">new</span> <span class="n">GUILayout</span><span class="p">.</span><span class="nf">HorizontalScope</span><span class="p">()){</span>
        <span class="n">path</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">TextField</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"choose"</span><span class="p">)){</span>
            <span class="c1">//set default values for directory, then try to override them with values of existing path</span>
            <span class="kt">string</span> <span class="n">directory</span> <span class="p">=</span> <span class="s">"Assets"</span><span class="p">;</span>
            <span class="kt">string</span> <span class="n">fileName</span> <span class="p">=</span> <span class="s">"MaterialImage.png"</span><span class="p">;</span>
            <span class="k">try</span><span class="p">{</span>
                <span class="n">directory</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetDirectoryName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                <span class="n">fileName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetFileName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
            <span class="kt">string</span> <span class="n">chosenFile</span> <span class="p">=</span> <span class="n">EditorUtility</span><span class="p">.</span><span class="nf">SaveFilePanelInProject</span><span class="p">(</span><span class="s">"Choose image file"</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> 
                    <span class="s">"png"</span><span class="p">,</span> <span class="s">"Please enter a file name to save the image to"</span><span class="p">,</span> <span class="n">directory</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">chosenFile</span><span class="p">)){</span>
                <span class="n">path</span> <span class="p">=</span> <span class="n">chosenFile</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">//repaint editor because the file changed and we can't set it in the textfield retroactively</span>
            <span class="nf">Repaint</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">FilePath</span> <span class="p">=</span> <span class="nf">FileField</span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/030/EditorWithFileChooser.png" alt="" /></p>

<h2 id="3d-texture-baking">3D Texture Baking</h2>

<p>We can get even more flexibility out of our textures by baking them into a volumetric 3d texture. There is no texture format for 3d textures, but we can use unity’s internal Texture3D format and save that as a asset. Theres also no easy way I know of to output a 3d volume out of a shader without using compute shaders, something I don’t want to get into here. My solution for this is to render different “slices” of the 3d texture, one 2d image at a time and then manually feed them into the 3d texture. To get the different slices out of a shader, I’ll add a height property to the shader which we can change between rendering slices.</p>

<p>For the 3d texture baking we’ll start with the 2d version of the texture baking tools, rename the class and menuitem so it doesn’t clash with the 2d version and change the resolution. We change the resolution to a <code class="language-plaintext highlighter-rouge">Vector3Int</code>, change it’s gui field to a <code class="language-plaintext highlighter-rouge">Vector3IntField</code> and make sure the z coordinate is also above 0 in the <code class="language-plaintext highlighter-rouge">CheckInput</code> method. We’ll also save the 3d texture as a unity asset instead of a texture, so we’ll change all occurances of <code class="language-plaintext highlighter-rouge">png</code> to <code class="language-plaintext highlighter-rouge">asset</code>. After that we’ll just have to rewrite the <code class="language-plaintext highlighter-rouge">BakeTexture</code> function.</p>

<p>Because we’ll be rendering several times, we’ll create our texture variable right at the beginning with the rendertexture. We’ll also create a 2d texture together with our 2d texture, that’s so we can use it to access the data of the rendertexture. The 3d texture has to have a textureformat. I use ARGB32, which means it has 32 bit color depth, or 8 bit per channel which gives us 256 different color values per channel. It also wants to know wether we want to generate mipmaps. I’ve declined that here, because 3d textures can become pretty big without mipmaps and just become bigger when we enable them(if you make a 128x128x128 px 3d texture, that’s the about as big as 128 128x128 2d textures).</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">BakeTexture</span><span class="p">(){</span>
    <span class="c1">//get rendertexture to render layers to and texture3d to save values to as well as 2d texture for transferring data</span>
    <span class="n">RenderTexture</span> <span class="n">renderTexture</span> <span class="p">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">GetTemporary</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
    <span class="n">Texture3D</span> <span class="n">volumeTexture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture3D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">TextureFormat</span><span class="p">.</span><span class="n">ARGB32</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="n">Texture2D</span> <span class="n">tempTexture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture2D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

    <span class="c1">//TODO: loop through slices and write them to 3d texture</span>

    <span class="c1">//TODO: save 3d texture</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Before we start the loop we calculate how many voxels the 3d texture has by multiplying the width, height and depth and how many pixels a single slice has by just multiplying the width and height. We then create a array of colors the size of the voxel amount of the texture so we can slowly fill it. We’ll use the <code class="language-plaintext highlighter-rouge">Color32</code> because <code class="language-plaintext highlighter-rouge">Texture2D</code> as well as <code class="language-plaintext highlighter-rouge">Texture3D</code> use it internally, so it’s a bit faster. We’ll also set the rendertexture we have as the active rendertexture so we don’t have to do that every iteration of the loop.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="n">renderTexture</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">voxelAmount</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">slicePixelAmount</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="n">Color32</span><span class="p">[]</span> <span class="n">colors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Color32</span><span class="p">[</span><span class="n">voxelAmount</span><span class="p">];</span>
</code></pre></div></div>

<p>Then we loop through the slices. We have as many slices as we have resolution in the z axis, so we loop that amount of times. We start the loop calculating the height of the slice. We do that by adding 0.5 to the slice index and dividing it my the depth of the resolution. The 0.5 is so we always hit the middle of the voxels, so a 2 voxel tall texture would have the voxel midpoints at 0.25 and 0.75 instead of 0 and 0.5 which would be edges of the voxels. After we have that value, we can apply it to our material. I’ll use the repeating 3d voronoi noise in the material, so the height property is called <code class="language-plaintext highlighter-rouge">_Height</code>, but you can use a different name or even expose the height property name to the inspector if you want to use different names for the variable in different shaders.</p>

<p>After that we get the slice by just calling the blit function and letting it write to the rendertexture. Then we copy the content of the rendertexture to out temporary texture. The size of the area we copy is the width and height of the volumetric texture. After we have the data in a texture we can retrieve the colors of the texture. Then we calculate the start of the indices of this slice. We get that by simply multiplying the index of the current slice by the amount of pixels in a slice. Then we loop though all pixels in the current slice and copy them into the array of colors for the 3d texture. The index in the target array is the baseIndex of the slice plus the index of the pixel in the slice texture.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">slice</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">slice</span><span class="p">&lt;</span><span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">slice</span><span class="p">++){</span>
    <span class="kt">float</span> <span class="n">height</span> <span class="p">=</span> <span class="p">(</span><span class="n">slice</span> <span class="p">+</span> <span class="m">0.5f</span><span class="p">)</span> <span class="p">/</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
    <span class="n">ImageMaterial</span><span class="p">.</span><span class="nf">SetFloat</span><span class="p">(</span><span class="s">"_Height"</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>

    <span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">renderTexture</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">);</span>
    <span class="n">tempTexture</span><span class="p">.</span><span class="nf">ReadPixels</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="n">Color32</span><span class="p">[]</span> <span class="n">sliceColors</span> <span class="p">=</span> <span class="n">tempTexture</span><span class="p">.</span><span class="nf">GetPixels32</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">sliceBaseIndex</span> <span class="p">=</span> <span class="n">slice</span> <span class="p">*</span> <span class="n">slicePixelAmount</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">pixel</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">pixel</span><span class="p">&lt;</span><span class="n">slicePixelAmount</span><span class="p">;</span> <span class="n">pixel</span><span class="p">++){</span>
        <span class="n">colors</span><span class="p">[</span><span class="n">sliceBaseIndex</span> <span class="p">+</span> <span class="n">pixel</span><span class="p">]</span> <span class="p">=</span> <span class="n">sliceColors</span><span class="p">[</span><span class="n">pixel</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After the loop we put the pixels into the 3d texture via the <code class="language-plaintext highlighter-rouge">SetPixels32</code> function. After we did that we save the texture to a file by calling the <code class="language-plaintext highlighter-rouge">AssetDatabase.CreateAsset</code> function. We pass it the 3d texture as a first parameter and the path as a second.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//apply and save 3d texture</span>
<span class="n">volumeTexture</span><span class="p">.</span><span class="nf">SetPixels32</span><span class="p">(</span><span class="n">colors</span><span class="p">);</span>
<span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">CreateAsset</span><span class="p">(</span><span class="n">volumeTexture</span><span class="p">,</span> <span class="n">FilePath</span><span class="p">);</span>
</code></pre></div></div>

<p>At the end we clean up by destroying the textures and releasing the rendertexture.</p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//clean up variables</span>
<span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="n">RenderTexture</span><span class="p">.</span><span class="nf">ReleaseTemporary</span><span class="p">(</span><span class="n">renderTexture</span><span class="p">);</span>
<span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">volumeTexture</span><span class="p">);</span>
<span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">tempTexture</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/030/3dTex.png" alt="" /></p>

<h2 id="use-3d-textures">Use 3d textures</h2>

<p>So far we’ve always used 2d textures in our shaders, but using 3d textures isn’t much more difficult. We change the property from <code class="language-plaintext highlighter-rouge">2D</code> to <code class="language-plaintext highlighter-rouge">3D</code>, change the sampler to a <code class="language-plaintext highlighter-rouge">sampler3D</code> and read pixels from it with the <code class="language-plaintext highlighter-rouge">tex3D</code> instead of <code class="language-plaintext highlighter-rouge">tex2D</code> function which takes a 3d vector as a input. I’ll show you a little example shader which takes a height variable from outside, but you can just as well use a position or any other 3d vector. The main downside I see of 3d textures against 2d ones is that the scaling and offset of the UVs only works for 2 dimensions, so we can’t do everything with the transforms next to the texture that we can do with them for 2d textures.</p>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Properties</span><span class="p">{</span>
    <span class="n">_Height</span><span class="p">(</span><span class="s">"Height"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_Color</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">3</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//texture and transforms of the texture</span>
<span class="kt">sampler3D</span> <span class="n">_MainTex</span><span class="p">;</span>
<span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">_Height</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//the fragment shader</span>
<span class="n">fixed4</span> <span class="nf">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
    <span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">tex3D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_Height</span><span class="p">));</span>
    <span class="n">col</span> <span class="o">*=</span> <span class="n">_Color</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">col</span><span class="p">;</span>
<span class="err">}</span>
</code></pre></div></div>

<p><img src="/assets/images/posts/030/StepThrough3dTex.gif" alt="" /></p>

<h2 id="source">Source</h2>

<h3 id="bake-texture-window">Bake Texture Window</h3>
<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Editor/BakeTextureWindow.cs">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Editor/BakeTextureWindow.cs</a></li>
</ul>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BakeTextureWindow</span> <span class="p">:</span> <span class="n">EditorWindow</span> <span class="p">{</span>

    <span class="n">Material</span> <span class="n">ImageMaterial</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">FilePath</span> <span class="p">=</span> <span class="s">"Assets/MaterialImage.png"</span><span class="p">;</span>
    <span class="n">Vector2Int</span> <span class="n">Resolution</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hasMaterial</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hasResolution</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hasFilePath</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">MenuItem</span> <span class="p">(</span><span class="s">"Tools/Bake material to texture"</span><span class="p">)]</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//create window</span>
        <span class="n">BakeTextureWindow</span> <span class="n">window</span> <span class="p">=</span> <span class="n">EditorWindow</span><span class="p">.</span><span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">BakeTextureWindow</span><span class="p">&gt;();</span>
        <span class="n">window</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>

        <span class="n">window</span><span class="p">.</span><span class="nf">CheckInput</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">(){</span>
        <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Set the material you want to bake as well as the size "</span><span class="p">+</span>
                <span class="s">"and location of the texture you want to bake to, then press the \"Bake\" button."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>

        <span class="k">using</span><span class="p">(</span><span class="kt">var</span> <span class="n">check</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EditorGUI</span><span class="p">.</span><span class="nf">ChangeCheckScope</span><span class="p">()){</span>
            <span class="n">ImageMaterial</span> <span class="p">=</span> <span class="p">(</span><span class="n">Material</span><span class="p">)</span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">ObjectField</span><span class="p">(</span><span class="s">"Material"</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Material</span><span class="p">),</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Resolution</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">Vector2IntField</span><span class="p">(</span><span class="s">"Image Resolution"</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">);</span>
            <span class="n">FilePath</span> <span class="p">=</span> <span class="nf">FileField</span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">changed</span><span class="p">){</span>
                <span class="nf">CheckInput</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="n">hasMaterial</span> <span class="p">&amp;&amp;</span> <span class="n">hasResolution</span> <span class="p">&amp;&amp;</span> <span class="n">hasFilePath</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
            <span class="nf">BakeTexture</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="c1">//tell the user what inputs are missing</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasMaterial</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"You're still missing a material to bake."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasResolution</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Please set a size bigger than zero."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasFilePath</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"No file to save the image to given."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">CheckInput</span><span class="p">(){</span>
        <span class="c1">//check which values are entered already</span>
        <span class="n">hasMaterial</span> <span class="p">=</span> <span class="n">ImageMaterial</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">hasResolution</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">hasFilePath</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">try</span><span class="p">{</span>
            <span class="kt">string</span> <span class="n">ext</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetExtension</span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span>
            <span class="n">hasFilePath</span> <span class="p">=</span> <span class="n">ext</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">".png"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
    <span class="p">}</span>

    <span class="kt">string</span> <span class="nf">FileField</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">){</span>
        <span class="c1">//allow the user to enter output file both as text or via file browser</span>
        <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">LabelField</span><span class="p">(</span><span class="s">"Image Path"</span><span class="p">);</span>
        <span class="k">using</span><span class="p">(</span><span class="k">new</span> <span class="n">GUILayout</span><span class="p">.</span><span class="nf">HorizontalScope</span><span class="p">()){</span>
            <span class="n">path</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">TextField</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"choose"</span><span class="p">)){</span>
                <span class="c1">//set default values for directory, then try to override them with values of existing path</span>
                <span class="kt">string</span> <span class="n">directory</span> <span class="p">=</span> <span class="s">"Assets"</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">fileName</span> <span class="p">=</span> <span class="s">"MaterialImage.png"</span><span class="p">;</span>
                <span class="k">try</span><span class="p">{</span>
                    <span class="n">directory</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetDirectoryName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                    <span class="n">fileName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetFileName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
                <span class="kt">string</span> <span class="n">chosenFile</span> <span class="p">=</span> <span class="n">EditorUtility</span><span class="p">.</span><span class="nf">SaveFilePanelInProject</span><span class="p">(</span><span class="s">"Choose image file"</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> 
                        <span class="s">"png"</span><span class="p">,</span> <span class="s">"Please enter a file name to save the image to"</span><span class="p">,</span> <span class="n">directory</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">chosenFile</span><span class="p">)){</span>
                    <span class="n">path</span> <span class="p">=</span> <span class="n">chosenFile</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">//repaint editor because the file changed and we can't set it in the textfield retroactively</span>
                <span class="nf">Repaint</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">BakeTexture</span><span class="p">(){</span>
        <span class="c1">//render material to rendertexture</span>
        <span class="n">RenderTexture</span> <span class="n">renderTexture</span> <span class="p">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">GetTemporary</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">renderTexture</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">);</span>

        <span class="c1">//transfer image from rendertexture to texture</span>
        <span class="n">Texture2D</span> <span class="n">texture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture2D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="n">renderTexture</span><span class="p">;</span>
        <span class="n">texture</span><span class="p">.</span><span class="nf">ReadPixels</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="n">Vector2</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

        <span class="c1">//save texture to file</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="n">png</span> <span class="p">=</span> <span class="n">texture</span><span class="p">.</span><span class="nf">EncodeToPNG</span><span class="p">();</span>
        <span class="n">File</span><span class="p">.</span><span class="nf">WriteAllBytes</span><span class="p">(</span><span class="n">FilePath</span><span class="p">,</span> <span class="n">png</span><span class="p">);</span>
        <span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">Refresh</span><span class="p">();</span>

        <span class="c1">//clean up variables</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">ReleaseTemporary</span><span class="p">(</span><span class="n">renderTexture</span><span class="p">);</span>
        <span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="bake-texture3d-window">Bake Texture3d Window</h3>
<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Editor/BakeTexture3dWindow.cs">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Editor/BakeTexture3dWindow.cs</a></li>
</ul>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">BakeTexture3dWindow</span> <span class="p">:</span> <span class="n">EditorWindow</span> <span class="p">{</span>

    <span class="n">Material</span> <span class="n">ImageMaterial</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">FilePath</span> <span class="p">=</span> <span class="s">"Assets/MaterialImage.asset"</span><span class="p">;</span>
    <span class="n">Vector3Int</span> <span class="n">Resolution</span><span class="p">;</span>

    <span class="kt">bool</span> <span class="n">hasMaterial</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hasResolution</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">hasFilePath</span><span class="p">;</span>

    <span class="p">[</span><span class="nf">MenuItem</span> <span class="p">(</span><span class="s">"Tools/Bake material to 3d texture"</span><span class="p">)]</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">OpenWindow</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//create window</span>
        <span class="n">BakeTexture3dWindow</span> <span class="n">window</span> <span class="p">=</span> <span class="n">EditorWindow</span><span class="p">.</span><span class="n">GetWindow</span><span class="p">&lt;</span><span class="n">BakeTexture3dWindow</span><span class="p">&gt;();</span>
        <span class="n">window</span><span class="p">.</span><span class="nf">Show</span><span class="p">();</span>

        <span class="n">window</span><span class="p">.</span><span class="nf">CheckInput</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">OnGUI</span><span class="p">(){</span>
        <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Set the material you want to bake as well as the size "</span><span class="p">+</span>
                <span class="s">"and location of the texture you want to bake to, then press the \"Bake\" button."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">None</span><span class="p">);</span>

        <span class="k">using</span><span class="p">(</span><span class="kt">var</span> <span class="n">check</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EditorGUI</span><span class="p">.</span><span class="nf">ChangeCheckScope</span><span class="p">()){</span>
            <span class="n">ImageMaterial</span> <span class="p">=</span> <span class="p">(</span><span class="n">Material</span><span class="p">)</span><span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">ObjectField</span><span class="p">(</span><span class="s">"Material"</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Material</span><span class="p">),</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Resolution</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">Vector3IntField</span><span class="p">(</span><span class="s">"Image Resolution"</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">);</span>
            <span class="n">FilePath</span> <span class="p">=</span> <span class="nf">FileField</span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="n">check</span><span class="p">.</span><span class="n">changed</span><span class="p">){</span>
                <span class="nf">CheckInput</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="n">hasMaterial</span> <span class="p">&amp;&amp;</span> <span class="n">hasResolution</span> <span class="p">&amp;&amp;</span> <span class="n">hasFilePath</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"Bake"</span><span class="p">)){</span>
            <span class="nf">BakeTexture</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">GUI</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="c1">//tell the user what inputs are missing</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasMaterial</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"You're still missing a material to bake."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasResolution</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"Please set a size bigger than zero."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">hasFilePath</span><span class="p">){</span>
            <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">HelpBox</span><span class="p">(</span><span class="s">"No file to save the image to given."</span><span class="p">,</span> <span class="n">MessageType</span><span class="p">.</span><span class="n">Warning</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">CheckInput</span><span class="p">(){</span>
        <span class="c1">//check which values are entered already</span>
        <span class="n">hasMaterial</span> <span class="p">=</span> <span class="n">ImageMaterial</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">hasResolution</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">;</span>
        <span class="n">hasFilePath</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
        <span class="k">try</span><span class="p">{</span>
            <span class="kt">string</span> <span class="n">ext</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetExtension</span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span>
            <span class="n">hasFilePath</span> <span class="p">=</span> <span class="n">ext</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="s">".asset"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
    <span class="p">}</span>

    <span class="kt">string</span> <span class="nf">FileField</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">){</span>
        <span class="c1">//allow the user to enter output file both as text or via file browser</span>
        <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">LabelField</span><span class="p">(</span><span class="s">"Image Path"</span><span class="p">);</span>
        <span class="k">using</span><span class="p">(</span><span class="k">new</span> <span class="n">GUILayout</span><span class="p">.</span><span class="nf">HorizontalScope</span><span class="p">()){</span>
            <span class="n">path</span> <span class="p">=</span> <span class="n">EditorGUILayout</span><span class="p">.</span><span class="nf">TextField</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">GUILayout</span><span class="p">.</span><span class="nf">Button</span><span class="p">(</span><span class="s">"choose"</span><span class="p">)){</span>
                <span class="c1">//set default values for directory, then try to override them with values of existing path</span>
                <span class="kt">string</span> <span class="n">directory</span> <span class="p">=</span> <span class="s">"Assets"</span><span class="p">;</span>
                <span class="kt">string</span> <span class="n">fileName</span> <span class="p">=</span> <span class="s">"MaterialImage.asset"</span><span class="p">;</span>
                <span class="k">try</span><span class="p">{</span>
                    <span class="n">directory</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetDirectoryName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                    <span class="n">fileName</span> <span class="p">=</span> <span class="n">Path</span><span class="p">.</span><span class="nf">GetFileName</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">ArgumentException</span><span class="p">){}</span>
                <span class="kt">string</span> <span class="n">chosenFile</span> <span class="p">=</span> <span class="n">EditorUtility</span><span class="p">.</span><span class="nf">SaveFilePanelInProject</span><span class="p">(</span><span class="s">"Choose image file"</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> 
                        <span class="s">"asset"</span><span class="p">,</span> <span class="s">"Please enter a file name to save the image to"</span><span class="p">,</span> <span class="n">directory</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">chosenFile</span><span class="p">)){</span>
                    <span class="n">path</span> <span class="p">=</span> <span class="n">chosenFile</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="c1">//repaint editor because the file changed and we can't set it in the textfield retroactively</span>
                <span class="nf">Repaint</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">void</span> <span class="nf">BakeTexture</span><span class="p">(){</span>
        <span class="c1">//get rendertexture to render layers to and texture3d to save values to as well as 2d texture for transferring data</span>
        <span class="n">RenderTexture</span> <span class="n">renderTexture</span> <span class="p">=</span> <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">GetTemporary</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
        <span class="n">Texture3D</span> <span class="n">volumeTexture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture3D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">,</span> <span class="n">TextureFormat</span><span class="p">.</span><span class="n">ARGB32</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
        <span class="n">Texture2D</span> <span class="n">tempTexture</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Texture2D</span><span class="p">(</span><span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

        <span class="c1">//prepare for loop</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="n">renderTexture</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">voxelAmount</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">slicePixelAmount</span> <span class="p">=</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
        <span class="n">Color32</span><span class="p">[]</span> <span class="n">colors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Color32</span><span class="p">[</span><span class="n">voxelAmount</span><span class="p">];</span>

        <span class="c1">//loop through slices</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">slice</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">slice</span><span class="p">&lt;</span><span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span> <span class="n">slice</span><span class="p">++){</span>
            <span class="c1">//set z coodinate in shader</span>
            <span class="kt">float</span> <span class="n">height</span> <span class="p">=</span> <span class="p">(</span><span class="n">slice</span> <span class="p">+</span> <span class="m">0.5f</span><span class="p">)</span> <span class="p">/</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
            <span class="n">ImageMaterial</span><span class="p">.</span><span class="nf">SetFloat</span><span class="p">(</span><span class="s">"_Height"</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>

            <span class="c1">//get shader result</span>
            <span class="n">Graphics</span><span class="p">.</span><span class="nf">Blit</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">renderTexture</span><span class="p">,</span> <span class="n">ImageMaterial</span><span class="p">);</span>
            <span class="n">tempTexture</span><span class="p">.</span><span class="nf">ReadPixels</span><span class="p">(</span><span class="k">new</span> <span class="nf">Rect</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">Resolution</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">Color32</span><span class="p">[]</span> <span class="n">sliceColors</span> <span class="p">=</span> <span class="n">tempTexture</span><span class="p">.</span><span class="nf">GetPixels32</span><span class="p">();</span>

            <span class="c1">//copy slice to data for 3d texture</span>
            <span class="kt">int</span> <span class="n">sliceBaseIndex</span> <span class="p">=</span> <span class="n">slice</span> <span class="p">*</span> <span class="n">slicePixelAmount</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">pixel</span><span class="p">=</span><span class="m">0</span><span class="p">;</span> <span class="n">pixel</span><span class="p">&lt;</span><span class="n">slicePixelAmount</span><span class="p">;</span> <span class="n">pixel</span><span class="p">++){</span>
                <span class="n">colors</span><span class="p">[</span><span class="n">sliceBaseIndex</span> <span class="p">+</span> <span class="n">pixel</span><span class="p">]</span> <span class="p">=</span> <span class="n">sliceColors</span><span class="p">[</span><span class="n">pixel</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//apply and save 3d texture</span>
        <span class="n">volumeTexture</span><span class="p">.</span><span class="nf">SetPixels32</span><span class="p">(</span><span class="n">colors</span><span class="p">);</span>
        <span class="n">AssetDatabase</span><span class="p">.</span><span class="nf">CreateAsset</span><span class="p">(</span><span class="n">volumeTexture</span><span class="p">,</span> <span class="n">FilePath</span><span class="p">);</span>

        <span class="c1">//clean up variables</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="n">active</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="n">RenderTexture</span><span class="p">.</span><span class="nf">ReleaseTemporary</span><span class="p">(</span><span class="n">renderTexture</span><span class="p">);</span>
        <span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">volumeTexture</span><span class="p">);</span>
        <span class="nf">DestroyImmediate</span><span class="p">(</span><span class="n">tempTexture</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="read-from-3d-texture">Read from 3d Texture</h3>
<ul>
  <li><a href="https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Read3dTexture.shader">https://github.com/ronja-tutorials/ShaderTutorials/blob/master/Assets/030_Bake_Material/Read3dTexture.shader</a></li>
</ul>

<div class="language-glsl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Shader</span> <span class="s">"Tutorial/030_BakeTextures/Read3dTexture"</span>
<span class="p">{</span>
	<span class="c1">//show values to edit in inspector</span>
	<span class="n">Properties</span><span class="p">{</span>
        <span class="n">_Height</span><span class="p">(</span><span class="s">"Height"</span><span class="p">,</span> <span class="n">Range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">_Color</span> <span class="p">(</span><span class="s">"Tint"</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">_MainTex</span> <span class="p">(</span><span class="s">"Texture"</span><span class="p">,</span> <span class="mi">3</span><span class="n">D</span><span class="p">)</span> <span class="o">=</span> <span class="s">"white"</span> <span class="p">{}</span>
	<span class="p">}</span>

	<span class="n">SubShader</span><span class="p">{</span>
		<span class="c1">//the material is completely non-transparent and is rendered at the same time as the other opaque geometry</span>
		<span class="n">Tags</span><span class="p">{</span> <span class="s">"RenderType"</span><span class="o">=</span><span class="s">"Opaque"</span> <span class="s">"Queue"</span><span class="o">=</span><span class="s">"Geometry"</span><span class="p">}</span>

		<span class="n">Pass</span><span class="p">{</span>
			<span class="n">CGPROGRAM</span>

			<span class="c1">//include useful shader functions</span>
			<span class="cp">#include "UnityCG.cginc"
</span>
			<span class="c1">//define vertex and fragment shader</span>
			<span class="cp">#pragma vertex vert
</span>			<span class="cp">#pragma fragment frag
</span>
			<span class="c1">//texture and transforms of the texture</span>
			<span class="kt">sampler3D</span> <span class="n">_MainTex</span><span class="p">;</span>
			<span class="n">float4</span> <span class="n">_MainTex_ST</span><span class="p">;</span>

			<span class="c1">//tint of the texture</span>
			<span class="n">fixed4</span> <span class="n">_Color</span><span class="p">;</span>

            <span class="kt">float</span> <span class="n">_Height</span><span class="p">;</span>

			<span class="c1">//the object data that's put into the vertex shader</span>
			<span class="k">struct</span> <span class="n">appdata</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">vertex</span> <span class="o">:</span> <span class="n">POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the data that's used to generate fragments and can be read by the fragment shader</span>
			<span class="k">struct</span> <span class="n">v2f</span><span class="p">{</span>
				<span class="n">float4</span> <span class="n">position</span> <span class="o">:</span> <span class="n">SV_POSITION</span><span class="p">;</span>
				<span class="n">float2</span> <span class="n">uv</span> <span class="o">:</span> <span class="n">TEXCOORD0</span><span class="p">;</span>
			<span class="p">};</span>

			<span class="c1">//the vertex shader</span>
			<span class="n">v2f</span> <span class="n">vert</span><span class="p">(</span><span class="n">appdata</span> <span class="n">v</span><span class="p">){</span>
				<span class="n">v2f</span> <span class="n">o</span><span class="p">;</span>
				<span class="c1">//convert the vertex positions from object space to clip space so they can be rendered</span>
				<span class="n">o</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">UnityObjectToClipPos</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">vertex</span><span class="p">);</span>
				<span class="n">o</span><span class="p">.</span><span class="n">uv</span> <span class="o">=</span> <span class="n">TRANSFORM_TEX</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_MainTex</span><span class="p">);</span>
				<span class="k">return</span> <span class="n">o</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="c1">//the fragment shader</span>
			<span class="n">fixed4</span> <span class="n">frag</span><span class="p">(</span><span class="n">v2f</span> <span class="n">i</span><span class="p">)</span> <span class="o">:</span> <span class="n">SV_TARGET</span><span class="p">{</span>
				<span class="n">fixed4</span> <span class="n">col</span> <span class="o">=</span> <span class="n">tex3D</span><span class="p">(</span><span class="n">_MainTex</span><span class="p">,</span> <span class="n">float3</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">uv</span><span class="p">,</span> <span class="n">_Height</span><span class="p">));</span>
				<span class="n">col</span> <span class="o">*=</span> <span class="n">_Color</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">col</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">ENDCG</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I hope this tool will be as useful to you as it is to me in helpling you create textures to reuse and make shaders that are way cheaper to calculate than they would be with procedural noise.</p>


    <p>
        You can also find me on twitter at <a href="https://www.twitter.com/totallyRonja">@totallyRonja</a>. If you liked my tutorial and want to support me you can do that on Patreon (<a href="https://www.patreon.com/RonjaTutorials">patreon.com/RonjaTutorials</a>) or Ko-Fi (<a href="https://ko-fi.com/RonjaTutorials">ko-fi.com/RonjaTutorials</a>).
    </p>
  </div>

  
    <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://ronja-tutorials.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
  
</article>


      <!-- SVG icons from https://iconmonstr.com -->

      <!-- Twitter icon -->
      <span class="my-span-icon">
          <a href="https://twitter.com/TotallyRonja" aria-label="'s Twitter" title="'s Twitter">
            <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" style="margin-top: 12px;margin-left: 13px;"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.066 9.645c.183 4.04-2.83 8.544-8.164 8.544-1.622 0-3.131-.476-4.402-1.291 1.524.18 3.045-.244 4.252-1.189-1.256-.023-2.317-.854-2.684-1.995.451.086.895.061 1.298-.049-1.381-.278-2.335-1.522-2.304-2.853.388.215.83.344 1.301.359-1.279-.855-1.641-2.544-.889-3.835 1.416 1.738 3.533 2.881 5.92 3.001-.419-1.796.944-3.527 2.799-3.527.825 0 1.572.349 2.096.907.654-.128 1.27-.368 1.824-.697-.215.671-.67 1.233-1.263 1.589.581-.07 1.135-.224 1.649-.453-.384.578-.87 1.084-1.433 1.489z"/></svg>
          </a>
        </span>

        <!-- RSS icon -->
        
          <span class="my-span-icon">
            <a href="/feed.xml" aria-label="RSS feed" title="'s RSS feed">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z"/></svg>
            </a>
          </span>
        
        <!-- Contact icon -->
        
        
          <span class="my-span-icon">
            <a href="/about.html" aria-label="Contact" title="Contact ">
              <svg class="my-svg-icon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path d="M12 .02c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-6.99 5.666-6.991-5.666h13.981zm.01 10h-14v-8.505l7 5.673 7-5.672v8.504z"/></svg>
            </a>
          </span>
        
    </section>

    
      <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-124040112-1', 'auto');
        ga('send', 'pageview');
      </script>
    
  </body>
</html>
